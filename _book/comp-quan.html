<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.175">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Navigating the complexities of real-world data analysis">
<title>Data Disasters - 3&nbsp; Computational Quandaries (WIP)</title>
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<script src="site_libs/quarto-nav/quarto-nav.js"></script><script src="site_libs/quarto-nav/headroom.min.js"></script><script src="site_libs/clipboard/clipboard.min.js"></script><meta name="quarto:offset" content="./">
<script src="site_libs/quarto-search/autocomplete.umd.js"></script><script src="site_libs/quarto-search/fuse.min.js"></script><script src="site_libs/quarto-search/quarto-search.js"></script><link href="./egre-aggr.html" rel="next">
<link href="./data-dall.html" rel="prev">
<link href="./figures/cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script><script src="site_libs/quarto-html/popper.min.js"></script><script src="site_libs/quarto-html/tippy.umd.min.js"></script><script src="site_libs/quarto-html/anchor.min.js"></script><link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="site_libs/bootstrap/bootstrap.min.js"></script><link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
    "location": "sidebar",
    "copy-button": false,
    "collapse-after": 3,
    "panel-placement": "start",
    "type": "textbox",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-C7VEESJ7Z8"></script><script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-C7VEESJ7Z8', { 'anonymize_ip': true});
  </script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
<meta property="og:title" content="Data Disasters - 3&nbsp; Computational Quandaries (WIP)">
<meta property="og:description" content="Navigating the complexities of real-world data analysis">
<meta property="og:site-name" content="Data Disasters">
<meta name="twitter:title" content="Data Disasters - 3&nbsp; Computational Quandaries (WIP)">
<meta name="twitter:description" content="Navigating the complexities of real-world data analysis">
<meta name="twitter:card" content="summary">
</head>
<body class="floating">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Computational Quandaries (WIP)</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Disasters</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/emilyriederer/data-disasters" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./comments.html" class="sidebar-item-text sidebar-link">Comments? Discuss here!</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./author.html" class="sidebar-item-text sidebar-link">About the Author</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction (TODO)</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Data</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-dall.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Dalliances (WIP)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./comp-quan.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Computational Quandaries (WIP)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./egre-aggr.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Egregious Aggregations (WIP)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vexi-visu.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Vexing Visualization (TODO)</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Analysis</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./incr-infe.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Incredible Inferences (TODO)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cava-caus.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cavalier Causality (TODO)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mind-mode.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Mindless Modeling (TODO)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./alte-algo.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Alternative Algorithms (TODO)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./futi-find.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Futile Findings (TODO)</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Workflow</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./comp-code.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Complexifying Code (TODO)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reje-repr.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Rejecting Reproducibility (TODO)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mour-mist.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mourning Mistakes (TODO)</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Appendices</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./more.html" class="sidebar-item-text sidebar-link">(APPENDIX) Appendix</a>
  </div>
</li>
    </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
<ul>
<li>
<a href="#preliminaries---data-computation" class="nav-link active" data-scroll-target="#preliminaries---data-computation"> <span class="header-section-number">3.1</span> Preliminaries - Data Computation</a>
<ul class="collapse">
<li><a href="#single-table-operations" class="nav-link" data-scroll-target="#single-table-operations"> <span class="header-section-number">3.1.1</span> Single Table Operations</a></li>
<li><a href="#multiple-table-operations" class="nav-link" data-scroll-target="#multiple-table-operations"> <span class="header-section-number">3.1.2</span> Multiple Table Operations</a></li>
<li><a href="#mechanics" class="nav-link" data-scroll-target="#mechanics"> <span class="header-section-number">3.1.3</span> Mechanics</a></li>
</ul>
</li>
<li>
<a href="#null-values" class="nav-link" data-scroll-target="#null-values"> <span class="header-section-number">3.2</span> Null Values</a>
<ul class="collapse">
<li><a href="#types-of-null-values" class="nav-link" data-scroll-target="#types-of-null-values"> <span class="header-section-number">3.2.1</span> Types of Null Values</a></li>
<li><a href="#aggregation" class="nav-link" data-scroll-target="#aggregation"> <span class="header-section-number">3.2.2</span> Aggregation</a></li>
<li><a href="#comparison" class="nav-link" data-scroll-target="#comparison"> <span class="header-section-number">3.2.3</span> Comparison</a></li>
</ul>
</li>
<li>
<a href="#logicals-todo" class="nav-link" data-scroll-target="#logicals-todo"> <span class="header-section-number">3.3</span> Logicals (TODO)</a>
<ul class="collapse">
<li><a href="#language-specific-nuances-cut" class="nav-link" data-scroll-target="#language-specific-nuances-cut"> <span class="header-section-number">3.3.1</span> Language-specific nuances (CUT?)</a></li>
<li><a href="#comparison-todo" class="nav-link" data-scroll-target="#comparison-todo"> <span class="header-section-number">3.3.2</span> Comparison (TODO)</a></li>
</ul>
</li>
<li>
<a href="#numbers-todo" class="nav-link" data-scroll-target="#numbers-todo"> <span class="header-section-number">3.4</span> Numbers (TODO)</a>
<ul class="collapse">
<li><a href="#integer-division" class="nav-link" data-scroll-target="#integer-division"> <span class="header-section-number">3.4.1</span> Integer division</a></li>
<li><a href="#inexact-storage-and-comparison" class="nav-link" data-scroll-target="#inexact-storage-and-comparison"> <span class="header-section-number">3.4.2</span> Inexact storage and comparison</a></li>
<li><a href="#division-by-zero" class="nav-link" data-scroll-target="#division-by-zero"> <span class="header-section-number">3.4.3</span> Division by zero</a></li>
</ul>
</li>
<li>
<a href="#strings-wip" class="nav-link" data-scroll-target="#strings-wip"> <span class="header-section-number">3.5</span> Strings (WIP)</a>
<ul class="collapse">
<li><a href="#dirty-strings-todo" class="nav-link" data-scroll-target="#dirty-strings-todo"> <span class="header-section-number">3.5.1</span> Dirty Strings (TODO)</a></li>
<li><a href="#regular-expressions-todo" class="nav-link" data-scroll-target="#regular-expressions-todo"> <span class="header-section-number">3.5.2</span> Regular Expressions (TODO)</a></li>
<li><a href="#comparison-1" class="nav-link" data-scroll-target="#comparison-1"> <span class="header-section-number">3.5.3</span> Comparison</a></li>
<li><a href="#transformation-todo" class="nav-link" data-scroll-target="#transformation-todo"> <span class="header-section-number">3.5.4</span> Transformation (TODO)</a></li>
</ul>
</li>
<li>
<a href="#dates-and-times-wip" class="nav-link" data-scroll-target="#dates-and-times-wip"> <span class="header-section-number">3.6</span> Dates and Times (WIP)</a>
<ul class="collapse">
<li><a href="#comparison-2" class="nav-link" data-scroll-target="#comparison-2"> <span class="header-section-number">3.6.1</span> Comparison</a></li>
</ul>
</li>
<li><a href="#changing-data-types-todo" class="nav-link" data-scroll-target="#changing-data-types-todo"> <span class="header-section-number">3.7</span> Changing Data Types (TODO)</a></li>
<li><a href="#factors-in-r-todo" class="nav-link" data-scroll-target="#factors-in-r-todo"> <span class="header-section-number">3.8</span> Factors in R (TODO)</a></li>
<li>
<a href="#programming-errors-todo" class="nav-link" data-scroll-target="#programming-errors-todo"> <span class="header-section-number">3.9</span> Programming Errors (TODO)</a>
<ul class="collapse">
<li><a href="#default-cases-wip" class="nav-link" data-scroll-target="#default-cases-wip"> <span class="header-section-number">3.9.1</span> Default Cases (WIP)</a></li>
<li><a href="#order-of-operations-wip" class="nav-link" data-scroll-target="#order-of-operations-wip"> <span class="header-section-number">3.9.2</span> Order of Operations (WIP)</a></li>
<li><a href="#object-references-wip" class="nav-link" data-scroll-target="#object-references-wip"> <span class="header-section-number">3.9.3</span> Object References (WIP)</a></li>
</ul>
</li>
<li>
<a href="#trusting-tools" class="nav-link" data-scroll-target="#trusting-tools"> <span class="header-section-number">3.10</span> Trusting Tools</a>
<ul class="collapse">
<li><a href="#delegating-decisions" class="nav-link" data-scroll-target="#delegating-decisions"> <span class="header-section-number">3.10.1</span> Delegating decisions</a></li>
<li><a href="#off-label-use-todo" class="nav-link" data-scroll-target="#off-label-use-todo"> <span class="header-section-number">3.10.2</span> “Off-Label” Use (TODO)</a></li>
<li><a href="#security-todo" class="nav-link" data-scroll-target="#security-todo"> <span class="header-section-number">3.10.3</span> Security (TODO)</a></li>
</ul>
</li>
<li><a href="#inefficient-processing-todo" class="nav-link" data-scroll-target="#inefficient-processing-todo"> <span class="header-section-number">3.11</span> Inefficient Processing (TODO)</a></li>
<li>
<a href="#strategies-wip" class="nav-link" data-scroll-target="#strategies-wip"> <span class="header-section-number">3.12</span> Strategies (WIP)</a>
<ul class="collapse">
<li><a href="#understand-the-intent" class="nav-link" data-scroll-target="#understand-the-intent"> <span class="header-section-number">3.12.1</span> Understand the intent</a></li>
<li><a href="#understand-the-execution" class="nav-link" data-scroll-target="#understand-the-execution"> <span class="header-section-number">3.12.2</span> Understand the execution</a></li>
<li><a href="#be-explicit-not-implicit" class="nav-link" data-scroll-target="#be-explicit-not-implicit"> <span class="header-section-number">3.12.3</span> Be explicit not implicit</a></li>
</ul>
</li>
<li><a href="#real-world-disasters-wip" class="nav-link" data-scroll-target="#real-world-disasters-wip"> <span class="header-section-number">3.13</span> Real World Disasters (WIP)</a></li>
</ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/emilyriederer/data-disasters/edit/main/comp-quan.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"><h1 class="title display-7"><span id="sec-comp-quan" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Computational Quandaries (WIP)</span></span></h1><div class="quarto-description"><p>Navigating the complexities of real-world data analysis</p></div></div></header><p>After gaining confidence in one’s data (or, at least, making peace with it), the next step in a data analysis is often to start cleaning and exploring that data with summary statistics, plots, and models. Generally, this requires a computational tool like SQL, R, or python.</p>
<p>The process of computation itself can be fraught with challenges. Computational tools are extremely literal; they are excellent at doing <em>precisely what they were told to do</em> but not often what analysts might have <em>meant</em> or <em>wished</em> that they would do. Additionally, the moment an analyst begins to use a tool, the conversation is no longer between them and the data; suddenly, the mental model of how every single tool developer thought you might want to do analysis affects the tools’ behaviors and the analysts’ results.</p>
<p>In this chapter, we will explore common ways that tools may do something technically correct, reasonable, and as-intended but very much not what analysts may expect. Along the way, we will see how computational methods interact with the data encoding choices we discussed in <a href="data-dall.html">Section&nbsp;<span>2</span></a> (Data Dalliances).</p>
<section id="preliminaries---data-computation" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="preliminaries---data-computation">
<span class="header-section-number">3.1</span> Preliminaries - Data Computation</h2>
<p>Before we think about specific tools or failure modes, we can first consider the common types of operations that the analytical tools allow us to do with our data.</p>
<section id="single-table-operations" class="level3" data-number="3.1.1"><h3 data-number="3.1.1" class="anchored" data-anchor-id="single-table-operations">
<span class="header-section-number">3.1.1</span> Single Table Operations</h3>
<p>Given a single data table, we may wish to do operations (illustrated in <a href="#fig-filt-aggr-tran">Figure&nbsp;<span>3.1</span></a>) such as:</p>
<ul>
<li>
<strong>Filtering</strong>: Extracting a subset of a dataset for analysis based on certain inclusion criteria for each record</li>
<li>
<strong>Aggregation</strong>: Grouping our data table by one or more variables and condensing information across records with <em>aggregate functions</em> like counts, sums, and averages</li>
<li>
<strong>Transformation</strong>: Create new columns or modifying existing columns to represent more complex or domain-specific context</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-filt-aggr-tran" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/comp-quan/filt-aggr-tran.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Figure 3.1: Illustration of basic single-table data wrangling operations</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="multiple-table-operations" class="level3" data-number="3.1.2"><h3 data-number="3.1.2" class="anchored" data-anchor-id="multiple-table-operations">
<span class="header-section-number">3.1.2</span> Multiple Table Operations</h3>
<p>Often, we can get additional value in an analysis by combining multiple types of information from difference tables. When working with multiple tables, we may be interested in:</p>
<ul>
<li>
<strong>Combining Row-wise</strong>: Taking multiple tables with the same schemas (column names and data types) and creating a single table which contains the union (all records), intersection (only matching), or difference (only in one) of the records in the two tables</li>
<li>
<strong>Combining Column-wise</strong>: Appending additional fields to existing records through joining (also known as merging) multiple tables</li>
</ul></section><section id="mechanics" class="level3" data-number="3.1.3"><h3 data-number="3.1.3" class="anchored" data-anchor-id="mechanics">
<span class="header-section-number">3.1.3</span> Mechanics</h3>
<p>All of these operations rely on a few core computational tasks:</p>
<ul>
<li>
<strong>Arithmetic</strong>: Basic addition, subtraction, multiplication, and division to aggregate and transform data</li>
<li>
<strong>Mapping</strong>: Similar to arithmetic, other one-to-one or many-to-one transformations of numerical or categorical data (such as binning into categories)</li>
<li>
<strong>Equality</strong>: Comparing whether or not two values are equal is critical for data filtering, column-wise combination, and certain types of data transformation</li>
<li>
<strong>Casting</strong>: Converting data types of different elements into a comparable format is necessary for row-wise combination and often a prerequisite to certain equality and arithmetic tasks</li>
</ul>
<p>While these operations may seem simple, their behavior within certain tools and when employed for certain data types may sometimes lead to unintuitive or misleading results.</p>
</section></section><section id="null-values" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="null-values">
<span class="header-section-number">3.2</span> Null Values</h2>
<p>In <a href="data-dall.html">Section&nbsp;<span>2</span></a> (Data Dalliances), we discuss how null values may represent many different concepts and be encoded in multiple different ways. In addition to those semantic challenges, various representations of null values may cause different computational problems.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> In this section, we will explore these potential failure modes.</p>
<section id="types-of-null-values" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="types-of-null-values">
<span class="header-section-number">3.2.1</span> Types of Null Values</h3>
<p>Not only can null values represent many different things (as explored in <a href="data-dall.html">Section&nbsp;<span>2</span></a>), they also may be represented in many different ways. Understanding how nulls are encoded in one’s dataset is a critical prerequisite to attempting any of the computations described in the subsequent sections.</p>
<section id="language-representations" class="level4" data-number="3.2.1.1"><h4 data-number="3.2.1.1" class="anchored" data-anchor-id="language-representations">
<span class="header-section-number">3.2.1.1</span> Language representations</h4>
<p>Different programming languages each offer their own versions of null values – and sometimes more than one. For example, the R language includes <code>NA</code>, typed <code>NA</code>s (e.g.&nbsp;<code>NA_integer_</code>, <code>NA_character_</code>), <code>NaN</code>, and <code>NULL</code>; meanwhile, core python has <code>None</code> and the <code>numpy</code> module provides a <code>nan</code>.</p>
<p>These different values carry different semantic and functional meanings. For example R’s <code>NA</code> generally means “the presence of an absence” whereas <code>NULL</code> is “the absence of a presence”. This is articulated more clearly if we examine the lengths of these objects and observe that <code>NA</code> has a length 1 whereas <code>NULL</code> has a length 0.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.finite</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.infinite</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] FALSE
[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 1
[1] 0</code></pre>
</div>
</div>
<p>As further proof that these are not interchangeable, we may use the helper functions <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> and <code><a href="https://rdrr.io/r/base/NULL.html">is.null()</a></code>. It’s false that <code>NA</code> is <code>NULL</code> and essentially unable to be evaluated if <code>NULL</code> is <code>NA</code> because <code>NULL</code>s are truly nothing.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE
[1] TRUE
logical(0)
[1] FALSE</code></pre>
</div>
</div>
<p>To further complicate matters, we have <code>NaN</code> (“not a number”), along with <code>-Inf</code> and <code>Inf</code>, which generally arise when we attempt to abuse R’s calculator. Somewhat charmingly, <code>Inf</code> and <code>-Inf</code> may be used in some rudimentary calculations where the limit is returned.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span><span class="op">/</span><span class="fl">0</span></span>
<span><span class="fl">0</span><span class="op">/</span><span class="fl">0</span></span>
<span><span class="fl">1</span><span class="op">/</span><span class="cn">Inf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] Inf
[1] NaN
[1] 0</code></pre>
</div>
</div>
</section><section id="sentinel-value-encoding" class="level4" data-number="3.2.1.2"><h4 data-number="3.2.1.2" class="anchored" data-anchor-id="sentinel-value-encoding">
<span class="header-section-number">3.2.1.2</span> Sentinel value encoding</h4>
<p>Beyond these null types offered natively by different programming languages, there are also many different data management <em>conventions</em> for null values. Because null values can have many meanings, sometimes missing fields are encoded with “out of range” values which intend to suggest a type of missingness.</p>
<p>For example, the US Census Bureau’s Medical Expenditure Panel Survey uses the following reserved codes to denote different types of missingness: (TODO: cite p10 https://www.meps.ahrq.gov/data_stats/download_data/pufs/h206a/h206adoc.pdf)</p>
<pre><code>- -1 INAPPLICABLE Question was not asked due to skip pattern
- -7 REFUSED Question was asked and respondent refused to answer question
- -8 DK Question was asked and respondent did not know answer
- -14 NOT YET TAKEN/USED Respondent answered that the medicine has not yet been used
- -15 CANNOT BE COMPUTED Value cannot be derived from data</code></pre>
<p>This approach preserves a lot of relevant information while, at the same time, being readily apparent that these values are not valid when the data is manually inspect. Unfortunately, manually inspecting every data field is rarely possible, and such sentinel values may go undetected when looking at higher-level summaries.</p>
<p>Consider a survey of a population of retired adults where age is coded as <code>999</code> if not provided. Below, we simulate 100,000 such observations that are uniformly distributed between the age of 65 and 95 (hence, have an expected value of 80). Next, we replace merely <em>half of a percent</em> with our “null” values of <code>999</code>. Taking the mean with these false values results in a mean of about 85. This number alone might not raise the alarm; after all, we know the dataset’s population is older adults. However, accidentally treating these as valid values biases our results by a somewhat remarkable five years.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100000</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.01</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">65</span>, <span class="fl">95</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ages_nulls</span> <span class="op">&lt;-</span> <span class="va">ages</span></span>
<span><span class="va">ages_nulls</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">999</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ages</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ages_nulls</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 79.97897
[1] 84.57468</code></pre>
</div>
</div>
<p>So, the first order of business with null values is understanding how they are encoded and translating them to the most computationally appropriate form. However, that is only the beginning of the story.</p>
</section><section id="other-types-of-nulls-todo" class="level4" data-number="3.2.1.3"><h4 data-number="3.2.1.3" class="anchored" data-anchor-id="other-types-of-nulls-todo">
<span class="header-section-number">3.2.1.3</span> Other types of nulls (TODO)</h4>
<p>might be blank string which won’t get detected in standard null checks</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>same thing is true in dataframes</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">""</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarize_all</a></span><span class="op">(</span><span class="va">df</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  x
1 0</code></pre>
</div>
</div>
<p>in such cases, need to explicitly check for such alternative encodings like blank strings</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|</span> <span class="va">x</span> <span class="op">==</span> <span class="st">""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>of course, a blank string isn’t the only choice<br>
could also have an empty string of any length</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"  "</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|</span> <span class="va">x</span> <span class="op">==</span> <span class="st">""</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">""</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] FALSE
[1] TRUE
[1] TRUE</code></pre>
</div>
</div>
<p>we’ll see more about how fluid strings can be in the string section below</p>
</section></section><section id="aggregation" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="aggregation">
<span class="header-section-number">3.2.2</span> Aggregation</h3>
<p>Once null values are coded as “true” nulls, how these nulls are handled in the simple aggregation of data varies both across different languages and across different functions within a language. To better understand the problems this might cause, we will look at examples in R and SQL.</p>
<p>To explore aggregation, let’s build a simple dataset. We will suppose that we are working with a subscription-based e-commerce service and that we are looking at a <code>spend</code> dataset with one record per customer and information about the amount they spent and returned in a given month:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spend</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    AMT_SPEND <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    AMT_RETURN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">spend</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  AMT_SPEND AMT_RETURN
1        10         NA
2        20         NA
3        NA         NA</code></pre>
</div>
</div>
<p>To compute the average amount spent (<code>AMT_SPEND</code>) with the <code>dplyr</code> package, an analyst might first reasonably write the following <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> statement. However, as we can see, due to the presence of null values within the <code>AMT_SPEND</code> column, the result of this aggregation is for the whole quantity of <code>AVG_SPEND</code> to be set to the value <code>NA</code>.</p>
<p>A glance at the documentation for the <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> function<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> reveals that the function has a parameter called <code>na.rm</code>. This parameter’s default value is <code>FALSE</code>, but, when it is set to <code>TRUE</code>, it removes null values from our dataset. Adding this argument to the previous statement allows us to reach a numerical answer.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="va">spend</span>, </span>
<span>          AVG_SPEND <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">AMT_SPEND</span><span class="op">)</span>,</span>
<span>          AVG_SPEND_NARM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">AMT_SPEND</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  AVG_SPEND AVG_SPEND_NARM
1        NA             15</code></pre>
</div>
</div>
<p>However, is this the <em>right</em> numerical answer? Recall that what <code>na.rm = TRUE</code> does is <em>drop</em> the null values from the set of numbers being averaged. However, suppose the null values represent that no purchases were made for a given customer in a given month. That is, zero dollars were spent. In effect, we have removed all non-purchasers from the data being averaged.</p>
<p>More precisely, we have switched from taking the average</p>
<p><span class="math display">\[
  \frac{ \sum_{1}^{n} Spend }{\sum_{1}^{n} 1}
\]</span> over all <span class="math inline">\(n\)</span> customers</p>
<p>to taking the average</p>
<p><span class="math display">\[
  \frac{ \sum_{Spend &gt; 0} Spend }{\sum_{Spend &gt; 0} 1}
\]</span> over only those customers with spend.</p>
<p>At face value, we could say that the code above is giving the incorrect answer; by dropping some low (zero) purchase amounts, the average amount spend per customer is inflated. A second perspective, which is someone more philosophically troubling, is that this tiny change to the code which fixed the <em>obvious</em> problem (returning a null value) has introduced a <em>non-obvious</em> problem by fundamentally changing the question that we are asking. By dropping all accounts from our table who made no purchases, we are no longer answering “What is the average amount spent by all of our customer?” but rather “What is the average amount spent by an actively engaged customer?” In the language of probability theory, we might say that we have then changed our estimand from the expected value of spend to expected value of spend conditional on spend being positive. This technical quirk has significant analytical impact.</p>
<p>To answer the real question at hand, we have a couple of options. We could manually <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> the amount spent with the option to drop nulls but then divide by the correct denominator (all observations – not just those with spend) or we could explicitly recode null values in <code>AMT_SPEND</code> to zero before taking the average.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Either of these options lead to the correct conclusion of a lower average spend amount.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    <span class="va">spend</span>,</span>
<span>    AVG_SPEND_MANUAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">AMT_SPEND</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    AVG_SPEND_RECODE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">AMT_SPEND</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  AVG_SPEND_MANUAL AVG_SPEND_RECODE
1               10               10</code></pre>
</div>
</div>
<p>This is all well and good if we could just accept that the behaviors above are simply how nulls work, but further complexity comes as we see that there is no industry standard across tools. For example, as the SQL code below shows, SQL’s <code>avg()</code> function behaves more like R’s <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> <em>with</em> the <code>na.rm = TRUE</code> option set (whereas, you may recall that R’s <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> behaves with <code>na.rm = FALSE</code> by default). That is, the default behavior of SQL is to only operate on the valid and available values. The result of this default may mean that it is less obvious when our dataset has null values. SQL, unlike R, does not ask for “permission” to drop out nulls; instead, it unilaterally makes a decision how to handle these variables.</p>
<div class="cell" data-output.var="null_col">
<div class="sourceCode" id="cb26"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">avg</span>(amt_spend) <span class="kw">as</span> AVG_SPEND</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> spend</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  AVG_SPEND
1        15</code></pre>
</div>
</div>
<p>However, this is not to suggest that null values cannot also be “destructive” in SQL (that is, returning null). While aggregation functions (which compute over the <em>rows/records</em>) like <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> and <code>avg()</code> drop nulls, operators like <code>+</code> and <code>-</code> (which compute <em>across columns/variables</em> in the <em>same row/record</em>) do not exhibit the same behavior. Consider, for example, if we wish to calculate the average net purchase amount (purchases minus returns) instead of the gross (total) purchase amount.</p>
<div class="cell" data-output.var="null_cols_0">
<div class="sourceCode" id="cb28"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">avg</span>(amt_spend <span class="op">-</span> amt_return) <span class="kw">as</span> AVG_SPEND_NET</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> spend</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  AVG_SPEND_NET
1            NA</code></pre>
</div>
</div>
<p>Despite what we learned above about SQL’s <code>avg()</code> function, the query above returns only a null value. What has happened? In our <code>spend</code> dataset, the <code>amt_return</code> column is completely null (representing no return purchases). Because the subtraction occurs before the average is taken, subtracting null values in the <code>amt_return</code> variable from valid numbers in <code>amt_spend</code> variable creates a new variable of all null values. This new variable, which is already all null, is passed to the <code>avg()</code> function. This process is shown step-by-step below.</p>
<div class="cell" data-output.var="null_cols">
<div class="sourceCode" id="cb30"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  amt_spend, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  amt_return, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  amt_spend<span class="op">-</span>amt_return </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> spend</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  AMT_SPEND AMT_RETURN amt_spend-amt_return
1        10         NA                   NA
2        20         NA                   NA
3        NA         NA                   NA</code></pre>
</div>
</div>
</section><section id="comparison" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="comparison">
<span class="header-section-number">3.2.3</span> Comparison</h3>
<p>Null values don’t just introduce complexity when doing arithmetic. Difficulties also arise any time multiple variables are assessed for equality or inequality. Since a null value is unknown, most programming languages generally will <em>not</em> consider nulls to be comparable with other nulls.</p>
<p>We can observe simple examples of this in both R and SQL. In neither language can a null value be assessed for equality or inequality versus either another number or another null.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="cn">NA</span> <span class="op">==</span> <span class="fl">3</span> </span>
<span><span class="cn">NA</span> <span class="op">&gt;</span> <span class="fl">10</span> </span>
<span><span class="cn">NA</span> <span class="op">==</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] NA
[1] NA
[1] NA</code></pre>
</div>
</div>
<div class="cell" data-output.var="null_compare">
<div class="sourceCode" id="cb34"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">NULL</span> <span class="op">=</span> <span class="dv">3</span>) <span class="kw">as</span> NULL_EQ_NUM,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">NULL</span> <span class="op">&gt;</span> <span class="dv">10</span>) <span class="kw">as</span> NULL_GT_NUM,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">NULL</span> <span class="op">=</span> <span class="kw">NULL</span>) <span class="kw">as</span> NULL_EQ_NULL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  NULL_EQ_NUM NULL_GT_NUM NULL_EQ_NULL
1          NA          NA           NA</code></pre>
</div>
</div>
<p>In these toy examples, such outcomes may seem perfectly logical. However, this same reasoning can arise in sneakier ways and lead to uninteded results when equality evaluations are <em>implicit</em> in the task at hand instead of the singular focus. We’ll now see examples from data filtering, joining, and transformation.</p>
<div class="rmdnote">
<p>If you’re familiar with SQL, you may have been surprised to notice that there is no <code>FROM</code> clause in the query above. In fact, SQL queries can treat values just like variables containing only a single record.</p>
<p>We will use this trick throughout the chapter for exploring how SQL works when we don’t have an ideal sample dataset to test certain scenarios. Beyond exposition in this book, this trick is also useful in practice.</p>
</div>
<section id="filtering" class="level4" data-number="3.2.3.1"><h4 data-number="3.2.3.1" class="anchored" data-anchor-id="filtering">
<span class="header-section-number">3.2.3.1</span> Filtering</h4>
<p>Suppose we want to split our dataset into two datasets based on high or low values of spend. We might assume the following two lines of code will create a clear partition (implying that each record would fall into exactly one group.)</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spend_lt20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">spend</span>, <span class="va">AMT_SPEND</span> <span class="op">&lt;</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">spend_gte20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">spend</span>, <span class="va">AMT_SPEND</span> <span class="op">&gt;=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, if we examine the resulting datasets, we see that <em>neither</em> contains the third record which had a null value for the <code>AMT_SPEND</code> variable.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spend_lt20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  AMT_SPEND AMT_RETURN
1        10         NA</code></pre>
</div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spend_gte20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  AMT_SPEND AMT_RETURN
1        20         NA</code></pre>
</div>
</div>
<p>The same situation results in SQL.</p>
<div class="cell" data-output.var="sql_spend_lt20">
<div class="sourceCode" id="cb41"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> spend</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> AMT_SPEND <span class="op">&lt;</span> <span class="dv">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  AMT_SPEND AMT_RETURN
1        10         NA</code></pre>
</div>
</div>
<div class="cell" data-output.var="sql_spend_gte20">
<div class="sourceCode" id="cb43"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> spend</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> AMT_SPEND <span class="op">&gt;=</span> <span class="dv">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  AMT_SPEND AMT_RETURN
1        20         NA</code></pre>
</div>
</div>
<p>This is a direct result of the fact that nulls cannot be compared for equality any inequality. We can think of data filtering as a two-step process: first evaluate whether the condition is TRUE or FALSE, then return only the records for which the condition holds true. When we conduct the more manual process of filtering step-by-step, we see that the null value of <code>AMT_SPEND</code> does not get a “truth value” when compared with a number. Thus, it is not contained in either “truth value” subset.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">spend</span>, is_lt20 <span class="op">=</span> <span class="op">(</span><span class="va">AMT_SPEND</span> <span class="op">&lt;</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  AMT_SPEND AMT_RETURN is_lt20
1        10         NA    TRUE
2        20         NA   FALSE
3        NA         NA      NA</code></pre>
</div>
</div>
<p>Thus, whenever our data has null values, the very common act of data filtering risks excluding important information.</p>
</section><section id="joining" class="level4" data-number="3.2.3.2"><h4 data-number="3.2.3.2" class="anchored" data-anchor-id="joining">
<span class="header-section-number">3.2.3.2</span> Joining</h4>
<p>The same phenomenon as described above also happens when joining multiple datasets.</p>
<p>Suppose we have multiple datasets we wish to merge based on columns denoting a record’s name and date of birthday. For ease of exploration, we will make the simplest possible such dataset and simply try to merge it to itself. (This may seem silly, but often when trying to understand <em>computationally</em> complex things, it is a good idea to make the scenario as simple as possible. In fact, this idea is core to the concept of computational unit tests which we will discuss at the end of this chapter.)</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bday</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>NAME <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Anne'</span>, <span class="st">'Bob'</span><span class="op">)</span>, BIRTHDAY <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'2000-01-01'</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bday</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  NAME   BIRTHDAY
1 Anne 2000-01-01
2  Bob       &lt;NA&gt;</code></pre>
</div>
</div>
<p>In SQL, if we try to join this table, the records in row 1 will match because <code>'Anne' == 'Anne'</code> and <code>'2000-01-01' == '2000-01-01'</code>. However, poor Bob’s record is eliminated because his birth date is logged as null, and <code>NA == NA</code> is false.</p>
<div class="cell" data-output.var="bday_join">
<div class="sourceCode" id="cb49"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="op">*</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  bday <span class="kw">as</span> a</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  bday <span class="kw">as</span> b</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  a.NAME <span class="op">=</span> b.NAME <span class="kw">and</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  a.BIRTHDAY <span class="op">=</span> b.BIRTHDAY</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  NAME   BIRTHDAY
1 Anne 2000-01-01</code></pre>
</div>
</div>
<p>In contrast, R’s <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::inner_join()</a></code> function will not do this by default. This function lets us specifically control how nulls are matches with the <code>na_matches</code> argument, with a default option to match on <code>NA</code> values. (You may read more about the argument by typing <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">?dplyr::inner_join</a></code> in the R console to pull up the documentation.)</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">bday</span>, <span class="va">bday</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'NAME'</span>, <span class="st">'BIRTHDAY'</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  NAME   BIRTHDAY
1 Anne 2000-01-01
2  Bob       &lt;NA&gt;</code></pre>
</div>
</div>
<p>This example then is not only a cautionary tale for how null values may unintentionally corrupt our data transformations but also how “brittle” our knowledge and intuition may be when moving between tools. Neither of these default behaviors is strictly better or worse, but they are definitely different and have real implications on our analysis.</p>
</section><section id="transformation" class="level4" data-number="3.2.3.3"><h4 data-number="3.2.3.3" class="anchored" data-anchor-id="transformation">
<span class="header-section-number">3.2.3.3</span> Transformation</h4>
<p>A common task in data analysis is to aggregate results by subgroup. For example, we might want to summarize how many customers (rows/records) spent more or less than $10. To discern this, we might create a categorical variable for high versus low purchase amounts, group by this variable and count.</p>
<p>The psuedocode would read something like this:</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">HIGH_LOW =</span> <span class="sc">&lt;</span><span class="er">&lt;</span> transform AMT_SPEND <span class="sc">&gt;</span><span class="er">&gt;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(HIGH_LOW) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To define the <code>HIGH_LOW</code> variable, we might use a function like <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">dplyr::if_else()</a></code>, or <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">dplyr::case_when()</a></code>. However, once again, we have the issue of how values are <em>partitioned</em> when nulls are included. If we recode any records with <code>AMT_SPEND</code> of less than or equal to 10 to “Low” and default the rest to “High”, we will accidentally count all null values in the “High” group.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spend</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HIGH_LOW <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">AMT_SPEND</span> <span class="op">&lt;=</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"Low"</span>, </span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"High"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">HIGH_LOW</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 2 x 2
# Groups:   HIGH_LOW [2]
  HIGH_LOW     n
  &lt;chr&gt;    &lt;int&gt;
1 High         2
2 Low          1</code></pre>
</div>
</div>
<p>Instead, it is more accurate and transparent (unless we know specifically what null values mean and what group they should be part of) to not let one of our “core” categories by the “default” case in our logic. We can explicitly encode any residual values as something like “OTHER” or “ERROR” to help us see that there is a problem requiring extra attention.</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spend</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>HIGH_LOW <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">AMT_SPEND</span> <span class="op">&lt;=</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"Low"</span>, </span>
<span>    <span class="va">AMT_SPEND</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"High"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"OTHER"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">HIGH_LOW</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 3 x 2
# Groups:   HIGH_LOW [3]
  HIGH_LOW     n
  &lt;chr&gt;    &lt;int&gt;
1 High         1
2 Low          1
3 OTHER        1</code></pre>
</div>
</div>
<p>While nulls contribute to this issue, it’s important to realize that nulls are not the only factor causing this error nor or they the solution. The more substantial issue is the careless use of defaults and <em>implicit</em> encoding versus <em>explicit</em> encoding. In the second form of the SQL query above, we are more specific about exactly what is allowed in each category which ensures any unexpected inputs will not be allowed to “sneak” into ordinary outputs.</p>
</section></section></section><section id="logicals-todo" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="logicals-todo">
<span class="header-section-number">3.3</span> Logicals (TODO)</h2>
<p>Much like the different versions of nulls that we met in the last section, logical data types use reserved keywords to represent <code>TRUE</code> and <code>FALSE</code>. (The exact formats of logical reserved keywords vary by language. R and SQL use <code>TRUE</code> and <code>FALSE</code> and python uses <code>TRUE</code> and <code>FALSE</code>.) This means that these names function like a number or a letter which intrinsically hold one specific value and cannot take on a different value besides their own.</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="cn">TRUE</span> <span class="op">=</span> <span class="fl">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-error">
<pre><code>Error in TRUE = 5: invalid (do_set) left-hand side to assignment</code></pre>
</div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">2</span> <span class="op">=</span> <span class="fl">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-error">
<pre><code>Error in 2 = 5: invalid (do_set) left-hand side to assignment</code></pre>
</div>
</div>
<p>Across languages, <code>TRUE</code> and <code>FALSE</code> are considered equivalent to the numeric representations of 1 and 0 respectively.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 1
[1] 0</code></pre>
</div>
</div>
<p>A consequence of this numerical equivalency is that <code>TRUE</code> and <code>FALSE</code> may be compared to each other or other numbers and be included in mathematical expressions.</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="cn">TRUE</span> <span class="op">&gt;</span> <span class="cn">FALSE</span></span>
<span><span class="cn">TRUE</span> <span class="op">&lt;</span> <span class="fl">5</span></span>
<span><span class="cn">FALSE</span> <span class="op">&gt;</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="cn">TRUE</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="cn">TRUE</span> <span class="op">*</span> <span class="fl">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE
[1] TRUE
[1] TRUE
[1] 2
[1] 5</code></pre>
</div>
</div>
<p>similar in SQL</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">TRUE</span> <span class="op">&gt;</span> <span class="kw">FALSE</span> <span class="kw">as</span> a,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">TRUE</span> <span class="op">&lt;</span> <span class="dv">5</span> <span class="kw">as</span> b,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FALSE</span> <span class="op">&gt;</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">as</span> c,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">TRUE</span> <span class="op">+</span> <span class="dv">1</span> <span class="kw">as</span> d,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">TRUE</span> <span class="op">*</span> <span class="dv">5</span> <span class="kw">as</span> e</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead><tr class="header">
<th style="text-align: right;">a</th>
<th style="text-align: right;">b</th>
<th style="text-align: right;">c</th>
<th style="text-align: right;">d</th>
<th style="text-align: right;">e</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
</tr></tbody>
</table>
</div>
</div>
<section id="language-specific-nuances-cut" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="language-specific-nuances-cut">
<span class="header-section-number">3.3.1</span> Language-specific nuances (CUT?)</h3>
<section id="keyword-abbrevations" class="level4" data-number="3.3.1.1"><h4 data-number="3.3.1.1" class="anchored" data-anchor-id="keyword-abbrevations">
<span class="header-section-number">3.3.1.1</span> Keyword abbrevations</h4>
<p>R also recognizes the abbreviations of <code>T</code> and <code>F</code> as <code>TRUE</code> and <code>FALSE</code> respectively; however this is not recommended. <code>T</code> and <code>F</code> are <em>not</em> reserved keywords, so they can be overwritten with a different value. This makes code using such abbreviations “brittle” and less reliable.</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">T</span><span class="op">)</span> <span class="op">{</span><span class="st">"Hello"</span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="st">"Goodbye"</span><span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">F</span><span class="op">)</span> <span class="op">{</span><span class="st">"Hello"</span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="st">"Goodbye"</span><span class="op">}</span></span>
<span><span class="cn">T</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">T</span><span class="op">)</span> <span class="op">{</span><span class="st">"Hello"</span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="st">"Goodbye"</span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "Hello"
[1] "Goodbye"
[1] "Goodbye"</code></pre>
</div>
</div>
</section><section id="alternative-representations" class="level4" data-number="3.3.1.2"><h4 data-number="3.3.1.2" class="anchored" data-anchor-id="alternative-representations">
<span class="header-section-number">3.3.1.2</span> Alternative representations</h4>
<p>We’ve previously seen that logicals have associated numerical values. Different languages may also treat their string representations differently.</p>
<p>For example, R believes that the string <code>"TRUE"</code> is equal to the logical value <code>TRUE</code> when directly compared. However, this relationships breaks the transitive property of mathematics<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> because <code>TRUE</code> equals both <code>1</code> and <code>"TRUE"</code>, yet <code>"TRUE"</code> does not equal <code>1</code> so the mathematical operations that can be done with logical <code>TRUE</code> cannot be done with string <code>"TRUE"</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="cn">TRUE</span> <span class="op">==</span> <span class="fl">1</span></span>
<span><span class="cn">TRUE</span> <span class="op">==</span> <span class="st">"TRUE"</span></span>
<span><span class="cn">TRUE</span> <span class="op">==</span> <span class="st">"True"</span></span>
<span><span class="cn">TRUE</span> <span class="op">*</span> <span class="fl">5</span></span>
<span><span class="st">"TRUE"</span> <span class="op">*</span> <span class="fl">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-error">
<pre><code>Error in "TRUE" * 5: non-numeric argument to binary operator</code></pre>
</div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE
[1] TRUE
[1] FALSE
[1] 5</code></pre>
</div>
</div>
<p>In contrast neither SQL not python honor the string forms of their respective logical reserved keywords at all.</p>
<div class="cell" data-output.var="bool_math">
<div class="sourceCode" id="cb72"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">TRUE</span> <span class="op">==</span> <span class="dv">1</span>) <span class="kw">as</span> is_int_true,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">TRUE</span> <span class="op">==</span> <span class="st">'TRUE'</span>) <span class="kw">as</span> is_char_true,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">TRUE</span><span class="op">*</span><span class="dv">5</span> <span class="kw">as</span> true_times_five,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">'TRUE'</span><span class="op">*</span><span class="dv">5</span> <span class="kw">as</span> true_str_time_five</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  is_int_true is_char_true true_times_five true_str_time_five
1           1            0               5                  0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="va">True</span> <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="va">True</span> <span class="op">==</span> <span class="st">"True"</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="va">True</span> <span class="op">==</span> <span class="st">"TRUE"</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="va">True</span> <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">"True"</span> <span class="op">*</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>True
False
False
5
'TrueTrueTrueTrueTrue'</code></pre>
</div>
</div>
</section></section><section id="comparison-todo" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="comparison-todo">
<span class="header-section-number">3.3.2</span> Comparison (TODO)</h3>
<p>The nuances of logical representation and handling seem straightforward in isolation. However, when encountered in real-world data problems, they are not isolated and are unlikely to be our main focus.</p>
<p>Imagine two datasets which all encode the same information but use boolean, string, and integer representations of a logical respectively.</p>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, IND <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">3</span><span class="op">)</span>, X <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, IND <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'TRUE'</span>, <span class="fl">5</span><span class="op">)</span>, Y <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, IND <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, Z <span class="op">=</span> <span class="fl">21</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By simple inspection, the logical and string representations in particular look superficially similar and yet they will behave differently.</p>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  ID  IND X
1  1 TRUE 1
2  2 TRUE 2
3  3 TRUE 3</code></pre>
</div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  ID  IND  Y
1  1 TRUE 11
2  2 TRUE 12
3  3 TRUE 13
4  4 TRUE 14
5  5 TRUE 15</code></pre>
</div>
</div>
<p>If we use R’s <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> or <code><a href="https://rdrr.io/r/base/subset.html">base::subset()</a></code> function to subset the data, the value of <code>df1</code> will correctly subset based on the boolean values of <code>IND</code>. However, R will not know how to interpret the string version in <code>df2</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">IND</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df2</span>, <span class="va">IND</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-error">
<pre><code>Error: Problem with `filter()` input `..1`.
i Input `..1` is `IND`.
x Input `..1` must be a logical vector, not a character.</code></pre>
</div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">df2</span>, <span class="va">df2</span><span class="op">$</span><span class="va">IND</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-error">
<pre><code>Error in subset.data.frame(df2, df2$IND): 'subset' must be logical</code></pre>
</div>
<div class="cell-output-stdout">
<pre><code>  ID  IND X
1  1 TRUE 1
2  2 TRUE 2
3  3 TRUE 3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">IND</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df2</span>, <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">IND</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] ID  IND X  
&lt;0 rows&gt; (or 0-length row.names)
[1] ID  IND Y  
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df2</span>, <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">IND</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] ID  IND Y  
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"IND"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-error">
<pre><code>Error: Can't join on `x$IND` x `y$IND` because of incompatible types.
i `x$IND` is of type &lt;logical&gt;&gt;.
i `y$IND` is of type &lt;character&gt;&gt;.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"IND"</span><span class="op">)</span>, by.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"IND"</span><span class="op">)</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  ID  IND X  Y
1  1 TRUE 1 11
2  2 TRUE 2 12
3  3 TRUE 3 13</code></pre>
</div>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> df1.<span class="op">*</span>, df2.<span class="op">*</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a> df1 </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a> <span class="kw">left</span> <span class="kw">join</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a> df2</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a> <span class="kw">on</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a> df1.<span class="kw">id</span> <span class="op">=</span> df2.<span class="kw">id</span> <span class="kw">and</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a> df1.ind <span class="op">=</span> df2.ind</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>3 records</caption>
<thead><tr class="header">
<th style="text-align: left;">ID</th>
<th style="text-align: right;">IND</th>
<th style="text-align: right;">X</th>
<th style="text-align: right;">ID</th>
<th style="text-align: left;">IND</th>
<th style="text-align: right;">Y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb95"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>data1 <span class="op">=</span> {<span class="st">'ID'</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'IND'</span>: [<span class="va">True</span>] <span class="op">*</span> <span class="dv">3</span>,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'X'</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> {<span class="st">'ID'</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>)),</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">'IND'</span>: [<span class="st">'True'</span>] <span class="op">*</span> <span class="dv">5</span>,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Y'</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">11</span>, <span class="dv">16</span>))}</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.DataFrame(data1)</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame(data2)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   ID   IND  X
0   1  True  1
1   2  True  2
2   3  True  3
   ID   IND   Y
0   1  True  11
1   2  True  12
2   3  True  13
3   4  True  14
4   5  True  15</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>pd.merge(left <span class="op">=</span> df1, right <span class="op">=</span> df2, how <span class="op">=</span> <span class="st">"left"</span>, on <span class="op">=</span> [<span class="st">'ID'</span>, <span class="st">'IND'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   ID   IND  X   Y
0   1  True  1 NaN
1   2  True  2 NaN
2   3  True  3 NaN</code></pre>
</div>
</div>
</section></section><section id="numbers-todo" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="numbers-todo">
<span class="header-section-number">3.4</span> Numbers (TODO)</h2>
<section id="integer-division" class="level3" data-number="3.4.1"><h3 data-number="3.4.1" class="anchored" data-anchor-id="integer-division">
<span class="header-section-number">3.4.1</span> Integer division</h3>
<p>In R (mostly what we’d expect)</p>
<div class="cell">
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fl">3</span><span class="op">/</span><span class="fl">4</span> <span class="op">&gt;</span> <span class="fl">0.5</span>, <span class="st">'High'</span>, <span class="st">'Low'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "High"</code></pre>
</div>
</div>
<p>In some SQL dialect SQL (SQLite shown. “Modern” interfaces like Snowflake and BigQuery don’t do this)</p>
<div class="cell" data-output.var="one_div_two">
<div class="sourceCode" id="cb103"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="kw">as</span> one_div_two</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  one_div_two
1           0</code></pre>
</div>
</div>
<p>This rounding can get masked when we are recoding or doing subsequent calculations</p>
<div class="cell" data-output.var="high_low">
<div class="sourceCode" id="cb105"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">when</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">then</span> <span class="st">'High'</span> </span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="st">'Low'</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span> <span class="kw">as</span> high_low_int,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">when</span> <span class="fl">3.0</span> <span class="op">/</span> <span class="dv">4</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">then</span> <span class="st">'High'</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="st">'Low'</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span> <span class="kw">as</span> high_low_float</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  high_low_int high_low_float
1          Low           High</code></pre>
</div>
</div>
<p>The above works because of implicit casting. We can also do explicit casting, but where we do this matters</p>
<div class="cell" data-output.var="cast_when">
<div class="sourceCode" id="cb107"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">when</span> <span class="fu">cast</span>(<span class="dv">3</span> <span class="kw">as</span> <span class="dt">float</span>) <span class="op">/</span> <span class="dv">4</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">then</span> <span class="st">'High'</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="st">'Low'</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span> <span class="kw">as</span> cast_first,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">when</span> <span class="fu">cast</span>(<span class="dv">3</span><span class="op">/</span><span class="dv">4</span> <span class="kw">as</span> <span class="dt">float</span>) <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">then</span> <span class="st">'High'</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="st">'Low'</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span> <span class="kw">as</span> cast_last</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  cast_first cast_last
1       High       Low</code></pre>
</div>
</div>
</section><section id="inexact-storage-and-comparison" class="level3" data-number="3.4.2"><h3 data-number="3.4.2" class="anchored" data-anchor-id="inexact-storage-and-comparison">
<span class="header-section-number">3.4.2</span> Inexact storage and comparison</h3>
<p>In R</p>
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="fl">3</span> <span class="op">-</span> <span class="fl">2.9</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0.1</span></span>
<span><span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">1.9</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0.1</span></span>
<span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] FALSE
[1] FALSE
[1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="fl">3</span> <span class="op">-</span> <span class="fl">2.9</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0.1</span></span>
<span><span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">1.9</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0.1</span></span>
<span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] FALSE
[1] FALSE
[1] FALSE</code></pre>
</div>
</div>
<p>despite the fact that we see no difference</p>
<div class="cell">
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">3</span> <span class="op">-</span> <span class="fl">2.9</span></span>
<span><span class="fl">2</span> <span class="op">-</span> <span class="fl">1.9</span></span>
<span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.1
[1] 0.1
[1] 0.1</code></pre>
</div>
</div>
<p>In python - same problem but in slightly different cases</p>
<div class="cell">
<div class="sourceCode" id="cb115"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">3</span> <span class="op">-</span> <span class="fl">2.9</span>) <span class="op">&lt;=</span> <span class="fl">0.1</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">2</span> <span class="op">-</span> <span class="fl">1.9</span>) <span class="op">&lt;=</span> <span class="fl">0.1</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span> <span class="op">-</span> <span class="fl">0.9</span>) <span class="op">&lt;=</span> <span class="fl">0.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>False
False
True</code></pre>
</div>
</div>
<p>here we can see the differences</p>
<div class="cell">
<div class="sourceCode" id="cb117"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="op">-</span> <span class="fl">2.9</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">-</span> <span class="fl">1.9</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span> <span class="fl">0.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>0.10000000000000009
0.10000000000000009
0.09999999999999998</code></pre>
</div>
</div>
<p>Same thing with SQL where differences are masked</p>
<div class="cell" data-output.var="float_math">
<div class="sourceCode" id="cb119"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span> <span class="op">-</span> <span class="fl">2.9</span> <span class="kw">as</span> sub_three,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> <span class="op">-</span> <span class="fl">1.9</span> <span class="kw">as</span> sub_two,</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="op">-</span> <span class="fl">0.9</span> <span class="kw">as</span> sub_one,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">3</span> <span class="op">-</span> <span class="fl">2.9</span>) <span class="op">&lt;=</span> <span class="fl">0.1</span> <span class="kw">as</span> sub_compare_three,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">2</span> <span class="op">-</span> <span class="fl">1.9</span>) <span class="op">&lt;=</span> <span class="fl">0.1</span> <span class="kw">as</span> sub_compare_two,</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="op">-</span> <span class="fl">0.9</span>) <span class="op">&lt;=</span> <span class="fl">0.1</span> <span class="kw">as</span> sub_compare_one</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  sub_three sub_two sub_one sub_compare_three sub_compare_two sub_compare_one
1       0.1     0.1     0.1                 0               0               1</code></pre>
</div>
</div>
<p>Instead, can use either built-in equality checker (python equivalent is <code>math.isclose</code>) or check that difference between two numbers is in very small window</p>
<div class="cell">
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.9</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.1</span> <span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1e-10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE
[1] TRUE</code></pre>
</div>
</div>
<p>Another example</p>
<div class="cell">
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">0.6</span> <span class="op">+</span> <span class="fl">0.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.9</code></pre>
</div>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">0.6</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">==</span> <span class="fl">0.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fl">.1</span> <span class="op">+</span> <span class="fl">.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.3</code></pre>
</div>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fl">.1</span> <span class="op">+</span> <span class="fl">.2</span>, digits <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.30000000000000004</code></pre>
</div>
</div>
</section><section id="division-by-zero" class="level3" data-number="3.4.3"><h3 data-number="3.4.3" class="anchored" data-anchor-id="division-by-zero">
<span class="header-section-number">3.4.3</span> Division by zero</h3>
<p>more of a design issue about the right way to handle</p>
<p>we’ve seen before how we have to understand other peoples use of null values</p>
<p>this is a case where we he to decide what makes most sense</p>
</section></section><section id="strings-wip" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="strings-wip">
<span class="header-section-number">3.5</span> Strings (WIP)</h2>
<p>String data can be inherently appealing. At their best, strings are used to bring more readable and human interpretable values into a dataset. However, string data and the processing thereof comes with its own challenges.</p>
<p>First, unlike numbers, human language strings can be ambiguously defined. <code>2</code> is the only number to represent the value of two. However, the incorporation of human language means that many different words, phrases, and formatting choices can represent the same concept. This is confounded by instances where string data was manually entered, as is the case with user-input data.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<p>Secondly, string data is one of the most flexible datatypes and can contain any other types of information – from should-be-logical values (<code>"yes"/"no"</code>, <code>"true"/"false"</code>), should-be-numeric values (<code>"27"</code>), should-be-date values (<code>"2020-01-01"</code>), and even complex data encodings like JSON blobs (<code>"{"name":{"first":"emily","last":"riederer"},"social":{"twitter":"emilyriederer","github":"emilyriederer","linkedin":"emilyriederer"}}"</code> with hideous formatting for emphasis.) For a data publisher, this may be a convenience, but as we will see it can turn into a frustration or a liability when functions and comparison operations are attempted with strings that semantically represent a different type of value.</p>
<section id="dirty-strings-todo" class="level3" data-number="3.5.1"><h3 data-number="3.5.1" class="anchored" data-anchor-id="dirty-strings-todo">
<span class="header-section-number">3.5.1</span> Dirty Strings (TODO)</h3>
<p>whitespace</p>
<div class="cell">
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">"a"</span> <span class="op">==</span> <span class="st">"a"</span></span>
<span><span class="st">"a b"</span> <span class="op">==</span> <span class="st">"a b"</span></span>
<span><span class="st">"a b"</span> <span class="op">==</span> <span class="st">"a  b"</span></span>
<span><span class="st">"a b"</span> <span class="op">==</span> <span class="st">"a b "</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE
[1] TRUE
[1] FALSE
[1] FALSE</code></pre>
</div>
</div>
<p>“fancy” characters (alternate encodings like ms word)</p>
<div class="cell">
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">' " '</span> <span class="op">==</span> <span class="st">' " '</span></span>
<span><span class="st">' “ '</span> <span class="op">==</span>=<span class="st">' " '</span> '</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE
[1] FALSE</code></pre>
</div>
</div>
<p>special characters and display versus values</p>
<div class="cell">
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"a\tb"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># what you see...</span></span>
<span><span class="va">x</span> <span class="op">==</span> <span class="st">"a    b"</span> <span class="co"># ...is not what you get</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>a   b[1] FALSE</code></pre>
</div>
</div>
</section><section id="regular-expressions-todo" class="level3" data-number="3.5.2"><h3 data-number="3.5.2" class="anchored" data-anchor-id="regular-expressions-todo">
<span class="header-section-number">3.5.2</span> Regular Expressions (TODO)</h3>
<p>we promised not to be solution oriented, but</p>
<p><em>not</em> knowing regex is a disaster when trying to work with string data…</p>
</section><section id="comparison-1" class="level3" data-number="3.5.3"><h3 data-number="3.5.3" class="anchored" data-anchor-id="comparison-1">
<span class="header-section-number">3.5.3</span> Comparison</h3>
<p>TODO</p>
<section id="string-ordering" class="level4" data-number="3.5.3.1"><h4 data-number="3.5.3.1" class="anchored" data-anchor-id="string-ordering">
<span class="header-section-number">3.5.3.1</span> String ordering</h4>
<p>Strings are ranked based on <em>alphabetical order</em> just like a dictionary. Some properties of this ordering include that:</p>
<ul>
<li>numbers are smaller than letters (<code>1 &lt; "a"</code>)</li>
<li>lower-case is smaller than upper case (<code>"a" &lt; "A"</code>)</li>
<li>fewer characters are smaller than more characters (<code>"a" &lt; "aa"</code>)</li>
</ul>
<p>Such rules make perfect sense for true characters. However, when strings are used as a “catch all” to represent other structures, typical comparison operators can produce odd results. For example, it is generally uncontroverisal that ninety-one is less than one hundred twenty. However, the string <code>"91"</code> is <em>greater than</em> <code>"120"</code> because only the character <code>"9"</code> is compared to the character <code>"1"</code>.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<div class="cell">
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">91</span> <span class="op">&lt;</span> <span class="fl">120</span></span>
<span><span class="st">"91"</span> <span class="op">&lt;</span> <span class="st">"120"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE
[1] FALSE</code></pre>
</div>
</div>
<p>When strings are used to represent dates and times, comparison operators may or may not work depending on the precise formatting conversions. Below, we see that “YYYYQQ”-formats sort correctly because the information is hierarchically nested; millenia are compared before centuries, centuries before decades, decades before years, and years before quarters. However, many other string representations of dates, like “QQ-YYYY” will not order correctly. Related topics will be discussed in the “Dates and Times” section.</p>
<div class="cell">
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">"20190Q4"</span> <span class="op">&lt;</span> <span class="st">"2020Q3"</span> <span class="co"># string (alphabetic) ordering same as semantic ordering</span></span>
<span><span class="st">"Q4-2019"</span> <span class="op">&lt;</span> <span class="st">"Q3-2020"</span> <span class="co"># string and semantic orderings are different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE
[1] FALSE</code></pre>
</div>
</div>
<p>These examples demonstrate that we shouldn’t rely on sorting schemes that follow different rules. Before doing comparisons on such types, its a safer bet to cast them to the format most truly representative of their types. If, for some reason, you do wish to keep them as strings, the second example shows that its is wise to format them in the most conducive format possible so things just work.</p>
</section><section id="type-coercion" class="level4" data-number="3.5.3.2"><h4 data-number="3.5.3.2" class="anchored" data-anchor-id="type-coercion">
<span class="header-section-number">3.5.3.2</span> Type coercion</h4>
<p>We discussed string comparison before when looking at “dirty” strings. More unexpected behavior arises when strings are compared across different data types. Many computing programs will attempt to <em>coerce</em> the objects to a similar and comparable type. Sometimes, this can be convenient as operations “just work”, but as always there is a cost for convenience. As we’ll see, delegating important decisions to our computing engine may not always capture the semantic relationships that we are most interested in.</p>
<p>For example, consider compare a string and a number. To make them more comparable, R will convert them both to strings before checking for equality. Thus, the number <code>2020</code> is equivalent to the string <code>"2020"</code> but not the string <code>"02020"</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">"2020"</span> <span class="op">==</span> <span class="fl">2020</span></span>
<span><span class="st">"02020"</span> <span class="op">==</span> <span class="fl">2020</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] TRUE
[1] FALSE</code></pre>
</div>
</div>
<p>In contrast, SQLite<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> thinks that the string <code>'2020'</code> is greater than the number 2020 and that these two quantities are not equal.</p>
<div class="cell" data-output.var="data_date">
<div class="sourceCode" id="cb143"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="cf">when</span>     <span class="st">'2020'</span> <span class="op">=</span>  <span class="dv">2020</span> <span class="cf">then</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">end</span> <span class="kw">as</span> is_eq,</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="cf">when</span> <span class="kw">not</span> <span class="st">'2020'</span> <span class="op">==</span> <span class="dv">2020</span> <span class="cf">then</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">end</span> <span class="kw">as</span> not_eq,</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="cf">when</span>     <span class="st">'2020'</span> <span class="op">&lt;</span>  <span class="dv">2020</span> <span class="cf">then</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">end</span> <span class="kw">as</span> is_lt,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="cf">when</span>     <span class="st">'2020'</span> <span class="op">&gt;</span>  <span class="dv">2020</span> <span class="cf">then</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">end</span> <span class="kw">as</span> is_gt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  is_eq not_eq is_lt is_gt
1     0      1     0     1</code></pre>
</div>
</div>
<p>^TODO: where this could cause problems (FIPS example?)</p>
</section></section><section id="transformation-todo" class="level3" data-number="3.5.4"><h3 data-number="3.5.4" class="anchored" data-anchor-id="transformation-todo">
<span class="header-section-number">3.5.4</span> Transformation (TODO)</h3>
<p>basic things like addition differ by language</p>
<p>in R, returns error:</p>
<div class="cell">
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">'a'</span> <span class="op">+</span> <span class="st">'b'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-error">
<pre><code>Error in "a" + "b": non-numeric argument to binary operator</code></pre>
</div>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">'a'</span> <span class="op">*</span> <span class="fl">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-error">
<pre><code>Error in "a" * 5: non-numeric argument to binary operator</code></pre>
</div>
</div>
<p>in SQLite, goes to zero:</p>
<div class="cell" data-output.var="string_math">
<div class="sourceCode" id="cb149"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'a'</span> <span class="op">+</span> <span class="st">'b'</span> <span class="kw">as</span> string_add,</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'a'</span><span class="op">*</span><span class="dv">5</span> <span class="kw">as</span> string_mult</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  string_add string_mult
1          0           0</code></pre>
</div>
</div>
<p>in python, does concatenation for <code>+</code> and analogous (concatenation of repeat) for <code>*</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb151"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">'a'</span> <span class="op">+</span> <span class="st">'b'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>'ab'</code></pre>
</div>
<div class="sourceCode" id="cb153"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">'a'</span> <span class="op">*</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>'aaaaa'</code></pre>
</div>
</div>
</section></section><section id="dates-and-times-wip" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="dates-and-times-wip">
<span class="header-section-number">3.6</span> Dates and Times (WIP)</h2>
<p>Unlike character strings, dates and times seem like they should be well defined with distinct, quantifiable components like years, months, and days. However, many different conventions for date formatting and underlying storage formats exist. This leads to similar challenges with dates and times as we saw with strings before.</p>
<p>Some common formats in the wild are:</p>
<ul>
<li>YYYYMMDD</li>
<li>YYYYMM</li>
<li>MMDDYYYY</li>
<li>DDMMYYYY</li>
<li>MM/DD/YYYY</li>
<li>MM/DD/YY</li>
<li>DD/MM/YYYY</li>
<li>YYYY-MM-DD (ISO8601)</li>
</ul>
<p>In addition to how dates are <em>formatted</em>, they may be stored in a variety of different ways “under the hood” such as Unix time (seconds since 1970-01-01 00:00:00 UTC) and Julian time (days since noon in Greenwich on November 24, 4714 B.C) (TODO).</p>
<p>To complicate matters further, many of these formats may be represented either by native date types in various programs or by more basic data types (such as integers for the first four and strings for the last four). In addition, analogous formats exist for <em>timestamps</em> which encode both calendar date and time of day (hour, minute, and second information).</p>
<p>TODO: why ISO8601?</p>
<section id="comparison-2" class="level3" data-number="3.6.1"><h3 data-number="3.6.1" class="anchored" data-anchor-id="comparison-2">
<span class="header-section-number">3.6.1</span> Comparison</h3>
<p>Automatic conversion of data types Dates versus timestamps</p>
<div class="cell">
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_dt</span> <span class="op">&lt;-</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  DT_ENROLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>,</span>
<span>  DT_PURCH  <span class="op">=</span> <span class="fl">20200101</span>,</span>
<span>  DT_LOGIN  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span><span class="op">(</span><span class="st">"2020-01-01T12:00:00"</span><span class="op">)</span> </span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<p>none of these are equal so nothing returns on filtering</p>
<div class="cell">
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df_dt</span>, <span class="va">DT_ENROLL</span> <span class="op">==</span> <span class="va">DT_PURCH</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df_dt</span>, <span class="va">DT_ENROLL</span> <span class="op">==</span> <span class="va">DT_LOGIN</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): Incompatible methods
("Ops.Date", "Ops.POSIXt") for "=="</code></pre>
</div>
<div class="cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>the same thing happens in sql</p>
<div class="cell" data-output.var="date1">
<div class="sourceCode" id="cb161"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> df_dt <span class="kw">where</span> DT_ENROLL <span class="op">=</span> DT_PURCH</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>[1] DT_ENROLL DT_PURCH  DT_LOGIN 
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<div class="cell" data-output.var="date2">
<div class="sourceCode" id="cb163"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> df_dt <span class="kw">where</span> DT_ENROLL <span class="op">=</span> DT_LOGIN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>[1] DT_ENROLL DT_PURCH  DT_LOGIN 
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>in what way aren’t they equal? to understand this its helpful to know how the computer encodes these dates</p>
<p>with <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code> in R we can see the numeric representation of the date</p>
<div class="cell">
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df_dt</span><span class="op">$</span><span class="va">DT_ENROLL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 18262</code></pre>
</div>
</div>
<p>this works the same way in SQL</p>
<div class="cell" data-output.var="date_num">
<div class="sourceCode" id="cb167"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="fu">cast</span>(DT_ENROLL <span class="kw">as</span> <span class="dt">integer</span>), <span class="fu">cast</span>(DT_PURCH <span class="kw">as</span> <span class="dt">integer</span>) <span class="kw">from</span> df_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  cast(DT_ENROLL as integer) cast(DT_PURCH as integer)
1                      18262                  20200101</code></pre>
</div>
</div>
<p>this has the implication that things that are on the same date have an inequality relationship in both languages</p>
<div class="cell">
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df_dt</span>, <span class="va">DT_ENROLL</span> <span class="op">&lt;</span> <span class="va">DT_PURCH</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<div class="cell" data-output.var="date_ineq">
<div class="sourceCode" id="cb171"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> </span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cast</span>(DT_ENROLL <span class="kw">as</span> <span class="dt">integer</span>), </span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="cf">when</span> DT_ENROLL <span class="op">&lt;</span> <span class="dv">18000</span> <span class="cf">then</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">end</span> <span class="kw">as</span> lt_18000,</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="cf">when</span> DT_ENROLL <span class="op">&lt;</span> <span class="dv">19000</span> <span class="cf">then</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">end</span> <span class="kw">as</span> lt_19000,</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="cf">when</span> DT_ENROLL <span class="op">&lt;</span> DT_PURCH <span class="cf">then</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">end</span> <span class="kw">as</span> lt_purch</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> df_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  cast(DT_ENROLL as integer) lt_18000 lt_19000 lt_purch
1                      18262        0        1        1</code></pre>
</div>
</div>
<p>Note this this can affect both filters and joins</p>
<p>and this similarly causes a more general problem when comparing a date to a date-as-an-integer</p>
<div class="cell">
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">20160501</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell" data-output.var="date_comp">
<div class="sourceCode" id="cb175"><pre class="sourceCode sql cell-code code-with-copy"><code class="sourceCode sql"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="fu">cast</span>(<span class="st">'2020-01-01'</span> <span class="kw">as</span> <span class="dt">date</span>) <span class="op">&gt;</span> <span class="dv">20160501</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-stdout">
<pre><code>  cast('2020-01-01' as date) &gt; 20160501
1                                     0</code></pre>
</div>
</div>
<!--

### Timestamps versus dates

::: {.cell}

```{.r .cell-code}
today <- as.Date(Sys.Date()) 
now <- as.POSIXct(Sys.time(), "America/New_York")
today == now
```

::: {.cell-output-stderr}
```
Warning: Incompatible methods ("Ops.Date", "Ops.POSIXt") for "=="
```
:::

::: {.cell-output-stdout}
```
[1] FALSE
```
:::

```{.r .cell-code}
today > now
```

::: {.cell-output-stderr}
```
Warning: Incompatible methods ("Ops.Date", "Ops.POSIXt") for ">"
```
:::

::: {.cell-output-stdout}
```
[1] FALSE
```
:::

```{.r .cell-code}
today < now
```

::: {.cell-output-stderr}
```
Warning: Incompatible methods ("Ops.Date", "Ops.POSIXt") for "<"
```
:::

::: {.cell-output-stdout}
```
[1] TRUE
```
:::
:::

::: {.cell}

```{.python .cell-code}
from datetime import date
from datetime import datetime

today = date.today()
now = datetime.now()
today == now
```

::: {.cell-output-stdout}
```
False
```
:::

```{.python .cell-code}
today < now
```

::: {.cell-output-error}
```
Error in py_call_impl(callable, dots$args, dots$keywords): TypeError: can't compare datetime.datetime to datetime.date

Detailed traceback:
  File "<string>", line 1, in <module>
```
:::

```{.python .cell-code}
today > now
```

::: {.cell-output-error}
```
Error in py_call_impl(callable, dots$args, dots$keywords): TypeError: can't compare datetime.datetime to datetime.date

Detailed traceback:
  File "<string>", line 1, in <module>
```
:::

```{.python .cell-code}
today_str = today.strftime('%Y-%m-%d')
now_str = now.strftime('%Y-%m-%d %H:%M:%S')
today_str == now_str
```

::: {.cell-output-stdout}
```
False
```
:::

```{.python .cell-code}
today_str < now_str
```

::: {.cell-output-stdout}
```
True
```
:::

```{.python .cell-code}
today_str > now_str
```

::: {.cell-output-stdout}
```
False
```
:::
:::

-->
</section></section><section id="changing-data-types-todo" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="changing-data-types-todo">
<span class="header-section-number">3.7</span> Changing Data Types (TODO)</h2>
<p>data types can incidentally change between programs</p>
<div class="cell">
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>DT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-10-01"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"-- At creation --"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Class of DT variable: %s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">DT</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">df</span>, file <span class="op">=</span> <span class="va">tmp</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"-- After saving and reloading with read.csv --"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Class of DT variable: %s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">DT</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "-- At creation --"
[1] "Class of DT variable: Date"
[1] "-- After saving and reloading with read.csv --"
[1] "Class of DT variable: character"</code></pre>
</div>
</div>
<p>some tools try to make “smart” guesses based on format</p>
<div class="cell">
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"-- After saving and reloading with readr --"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Class of DT variable: %s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">DT</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "-- After saving and reloading with readr --"
[1] "Class of DT variable: Date"</code></pre>
</div>
</div>
<p>however, this can make things slower or unideal (one example: https://github.com/tidyverse/readr/issues/1094#issuecomment-628612430). you can also specify your own types manually</p>
</section><section id="factors-in-r-todo" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="factors-in-r-todo">
<span class="header-section-number">3.8</span> Factors in R (TODO)</h2>
<div class="cell">
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] FALSE  TRUE FALSE  TRUE
[1]  TRUE FALSE  TRUE FALSE
[1] 1 2 1 2</code></pre>
</div>
</div>
</section><section id="programming-errors-todo" class="level2" data-number="3.9"><h2 data-number="3.9" class="anchored" data-anchor-id="programming-errors-todo">
<span class="header-section-number">3.9</span> Programming Errors (TODO)</h2>
<section id="default-cases-wip" class="level3" data-number="3.9.1"><h3 data-number="3.9.1" class="anchored" data-anchor-id="default-cases-wip">
<span class="header-section-number">3.9.1</span> Default Cases (WIP)</h3>
<p>see case-when example in nulls section</p>
</section><section id="order-of-operations-wip" class="level3" data-number="3.9.2"><h3 data-number="3.9.2" class="anchored" data-anchor-id="order-of-operations-wip">
<span class="header-section-number">3.9.2</span> Order of Operations (WIP)</h3>
<p>PEMDAS but sometimes still ambiguous</p>
<div class="cell">
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span>  <span class="op">*</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">3</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.6666667
[1] 0.3333333
[1] 2</code></pre>
</div>
</div>
<p>SQL clause order of evaluations</p>
</section><section id="object-references-wip" class="level3" data-number="3.9.3"><h3 data-number="3.9.3" class="anchored" data-anchor-id="object-references-wip">
<span class="header-section-number">3.9.3</span> Object References (WIP)</h3>
<p>Copying and modifying object overview</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/comp-quan/ref-val.PNG" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Different relationships between named variables and their values</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>When might each be preferred?</p>
<p>What risks are there if we don’t understand which we are doing?</p>
<p>In Python</p>
<div class="cell">
<div class="sourceCode" id="cb185"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>y.append(<span class="dv">4</span>)</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y)</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1, 2, 3, 4]
[1, 2, 3, 4]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb187"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> x.copy()</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>z.append(<span class="dv">5</span>)</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(z)</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1, 2, 3, 4, 5]
[1, 2, 3, 4]</code></pre>
</div>
</div>
<p>pandas DataFrame methods with <code>inplace</code> arg (<code>False</code> is default)</p>
<p>In R</p>
<div class="cell">
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, b<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">11</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">newDT</span> <span class="op">&lt;-</span> <span class="va">DT</span>        <span class="co"># reference, not copy</span></span>
<span><span class="va">newDT</span><span class="op">[</span><span class="fl">1</span>, <span class="va">a</span> <span class="op">:=</span> <span class="fl">100</span><span class="op">]</span> <span class="co"># modify new DT</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span>          <span class="co"># DT is modified too.</span></span>
<span></span>
<span><span class="va">DT</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, b<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">11</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">newDT</span> <span class="op">&lt;-</span> <span class="va">DT</span>        </span>
<span><span class="va">newDT</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">200</span>  <span class="co"># new operation</span></span>
<span><span class="va">newDT</span><span class="op">[</span><span class="fl">1</span>, <span class="va">a</span> <span class="op">:=</span> <span class="fl">100</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   a  b
1: 1 11
2: 2 12
     a  b
1: 100 11
2:   2 12
   a  b
1: 1 11
2: 2 12</code></pre>
</div>
</div>
<p>From https://stackoverflow.com/questions/10225098/understanding-exactly-when-a-data-table-is-a-reference-to-vs-a-copy-of-another</p>
<div class="cell">
<div class="sourceCode" id="cb191"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set-up sample data ----</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">'a'</span>: [<span class="dv">1</span>, <span class="dv">2</span>], </span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'b'</span>: [<span class="dv">11</span>, <span class="dv">12</span>]}</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> data)</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rename columns without replacing ----</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>df.rename(columns <span class="op">=</span> {<span class="st">'a'</span>:<span class="st">'x'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   x   b
0  1  11
1  2  12</code></pre>
</div>
<div class="sourceCode" id="cb193"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rename columns with replacing ----</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   a   b
0  1  11
1  2  12</code></pre>
</div>
<div class="sourceCode" id="cb195"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>df.rename(columns <span class="op">=</span> {<span class="st">'a'</span>:<span class="st">'x'</span>}, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   x   b
0  1  11
1  2  12</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">add_ones</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  x1
1  1
2  2
3  3
4  4
5  5</code></pre>
</div>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">add_ones</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="va">df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  x1
1  1
2  2
3  3
4  4
5  5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">add_ones</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  x1
1  1
2  2
3  3
4  4
5  5</code></pre>
</div>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">add_ones</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  x1 x0
1  1  0
2  2  0
3  3  0
4  4  0
5  5  0</code></pre>
</div>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  x1
1  1
2  2
3  3
4  4
5  5</code></pre>
</div>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">add_ones</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="va">df2</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  x1 x0
1  1  0
2  2  0
3  3  0
4  4  0
5  5  0</code></pre>
</div>
</div>
</section></section><section id="trusting-tools" class="level2" data-number="3.10"><h2 data-number="3.10" class="anchored" data-anchor-id="trusting-tools">
<span class="header-section-number">3.10</span> Trusting Tools</h2>
<section id="delegating-decisions" class="level3" data-number="3.10.1"><h3 data-number="3.10.1" class="anchored" data-anchor-id="delegating-decisions">
<span class="header-section-number">3.10.1</span> Delegating decisions</h3>
<p>A theme throughout this book is the fundamentally <em>social</em> nature of data analysis. Data analysis is fraught without understanding the countless decisions made along the way by those who generated it (whose data is reflected), those who collected it, those who migrated it, and those who have posed questions of it. On one hand, this is a beautiful aspect of analysis; on the other hand, it means that analysts and their analyses are subject to all of the cognitive and social psychological biases of everyday humans.</p>
<p>One such bias is “social proof”: assuming that if a tool behaves a certain way, it must be because it is correct.</p>
<p>Assuming that our tools know best is admittedly an attractive proposition. It appeals to a desire to think that someone, somewhere is “in charge” and, perhaps more critically, helps us avoid a domino effect of distrust (If we <em>don’t</em> trust our tools how can we trust our results? And if we can’t trust our results, how can we trust anything at all?) Unfortunately, there are many reasons are tools might not know best. For example, the tool’s developer might have:</p>
<ul>
<li>Made a mistake</li>
<li>Had a different analysis problem in mind with a different optimal approach</li>
<li>Been optimizing for a different constraint (e.g.&nbsp;explainability vs.&nbsp;accuracy, speed vs.&nbsp;theoretical properties)</li>
<li>Come from a community with different norms</li>
<li>Been affording users the flexibility to do things many ways even if they don’t agree</li>
<li>Built a certain feature for a different purpose than how you are using it</li>
<li>Not thought about it at all</li>
</ul>
<p>As a few concrete examples from popular open source tools. We’ll look briefly at the prominent python library <code>scikitlearn</code> for machine learning and Apache Spark, an engine for large-scale distributed data processing.</p>
<section id="defaults-in-scikitlearn" class="level4" data-number="3.10.1.1"><h4 data-number="3.10.1.1" class="anchored" data-anchor-id="defaults-in-scikitlearn">
<span class="header-section-number">3.10.1.1</span> Defaults in <code>scikitlearn</code>
</h4>
<p><code>scikitlearn</code>’s default behavior for logistic regression modeling<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> automatically applies L2 regularization. You might or might not know what this means, and you might or might not want to apply it to your problem. That’s fine. The important thing is that it <em>will</em> change your estimates and predictions, and it is <em>not</em> a part of the classical definition of that algorithm (for modelers coming from a statistical background.)</p>
<p>Of course, there’s nothing inherently wrong about this choice; the library authors just had different goals than a typical statistical. <code>scikitlearn</code> developer Olivier Grisel explains <a href="https://twitter.com/ogrisel/status/1167438229655773186?s=20">on Twitter</a> that this choice (and others in the library) is explained because “Scikit-learn was always designed to make it easy to get good predictive accuracy (eg as measured by CV) rather than as statistical inference library.” Additionally, this choice is documented in bold <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html">in the function documentation</a>.</p>
<p>However, an analyst could easily miss this nuance if they do not <em>read</em> the documentation. Or, if they <em>misinterpret</em> this choice as social proof that regularization is always the right approach, they might not make the best choice for their own analysis.</p>
</section><section id="algorithms-in-spark" class="level4" data-number="3.10.1.2"><h4 data-number="3.10.1.2" class="anchored" data-anchor-id="algorithms-in-spark">
<span class="header-section-number">3.10.1.2</span> Algorithms in <code>Spark</code>
</h4>
<p>As a second example, according to a 2015 <a href="https://issues.apache.org/jira/browse/SPARK-5133">Jira ticket</a>, developers of Spark considered multiple methodologies they could use when adding the functionality to compute feature importance for a random forest. Ultimately, a core contributor advised against permutation importance due to its computational cost.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figures/comp-quan/spark-jira.PNG" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">JIRA ticket for Spark with a discussion of which random forest variable importance algorithm to implement</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Clearly, no one wants a workflow that is too costly or timely to run. So, once again, there is no right or wrong. However, since every approach to feature importance has its own biases, pitfalls, and challenges in interpretation, it’s a mistake for an end-user to not carefully understand which algorithm is used and why.</p>
</section><section id="null-handling-in-ggplot2-todo" class="level4" data-number="3.10.1.3"><h4 data-number="3.10.1.3" class="anchored" data-anchor-id="null-handling-in-ggplot2-todo">
<span class="header-section-number">3.10.1.3</span> Null handling in <code>ggplot2</code> (TODO)</h4>
<div class="cell">
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.0.5</code></pre>
</div>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, </span>
<span>                 x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                 y1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>                 y2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">y1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="comp-quan_files/figure-html/unnamed-chunk-234-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">y2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="comp-quan_files/figure-html/unnamed-chunk-234-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">y1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="comp-quan_files/figure-html/unnamed-chunk-234-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">y2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="comp-quan_files/figure-html/unnamed-chunk-234-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="boxplots-in-ggplot2-todo" class="level4" data-number="3.10.1.4"><h4 data-number="3.10.1.4" class="anchored" data-anchor-id="boxplots-in-ggplot2-todo">
<span class="header-section-number">3.10.1.4</span> Boxplots in <code>ggplot2</code> (TODO)</h4>
<p>depending on how you change the scale it also changes the calculations</p>
<p>https://stackoverflow.com/questions/5677885/ignore-outliers-in-ggplot2-boxplot</p>
</section></section><section id="off-label-use-todo" class="level3" data-number="3.10.2"><h3 data-number="3.10.2" class="anchored" data-anchor-id="off-label-use-todo">
<span class="header-section-number">3.10.2</span> “Off-Label” Use (TODO)</h3>
<p>coined in https://www.rstudio.com/resources/rstudioglobal-2021/maintaining-the-house-the-tidyverse-built/</p>
</section><section id="security-todo" class="level3" data-number="3.10.3"><h3 data-number="3.10.3" class="anchored" data-anchor-id="security-todo">
<span class="header-section-number">3.10.3</span> Security (TODO)</h3>
<p>namespace squatting</p>
<p>executable code</p>
</section></section><section id="inefficient-processing-todo" class="level2" data-number="3.11"><h2 data-number="3.11" class="anchored" data-anchor-id="inefficient-processing-todo">
<span class="header-section-number">3.11</span> Inefficient Processing (TODO)</h2>
</section><section id="strategies-wip" class="level2" data-number="3.12"><h2 data-number="3.12" class="anchored" data-anchor-id="strategies-wip">
<span class="header-section-number">3.12</span> Strategies (WIP)</h2>
<p>Paragraph 1 TODO</p>
<p>Some computational quandaries are inherent to our tools themselves, but often they are a function both of the tools and the ways we chose to use them. More strategies related to writing robust and resilient code will be discussed in <a href="comp-code.html">Section&nbsp;<span>11</span></a> (Complexify Code).</p>
<section id="understand-the-intent" class="level3" data-number="3.12.1"><h3 data-number="3.12.1" class="anchored" data-anchor-id="understand-the-intent">
<span class="header-section-number">3.12.1</span> Understand the intent</h3>
<ul>
<li>read the docs</li>
<li>look at examples</li>
<li>don’t carry default knowledge between languages</li>
</ul></section><section id="understand-the-execution" class="level3" data-number="3.12.2"><h3 data-number="3.12.2" class="anchored" data-anchor-id="understand-the-execution">
<span class="header-section-number">3.12.2</span> Understand the execution</h3>
<ul>
<li>test out simple examples (like we’ve been doing)</li>
<li>specificlly try out corner cases</li>
</ul></section><section id="be-explicit-not-implicit" class="level3" data-number="3.12.3"><h3 data-number="3.12.3" class="anchored" data-anchor-id="be-explicit-not-implicit">
<span class="header-section-number">3.12.3</span> Be explicit not implicit</h3>
<ul>
<li>default arguments</li>
<li>examples above with casting, coalescingW</li>
</ul></section></section><section id="real-world-disasters-wip" class="level2" data-number="3.13"><h2 data-number="3.13" class="anchored" data-anchor-id="real-world-disasters-wip">
<span class="header-section-number">3.13</span> Real World Disasters (WIP)</h2>
<p>https://www.theguardian.com/politics/2020/oct/05/how-excel-may-have-caused-loss-of-16000-covid-tests-in-england</p>
<blockquote class="blockquote">
<p>The data error, which led to 15,841 positive tests being left off the official daily figures, means than 50,000 potentially infectious people may have been missed by contact tracers and not told to self-isolate.</p>
</blockquote>
<div class="cell">

</div>
<!--

In practice, data analysis requires using a number of advanced computational tools such as SQL, R, or python. Analysts must work in a partnerships with each tool to access and wrangle their data into an accessible form of information. However, the moment you as an analyst begins to use a tool, the conversation is no longer simply between you and the data; suddenly, thousands of developers who helper build your tools are now crowding into the room. Each may have contributed to the code behind your tool with a different mental model of how one would use it.

In this chapter, we will explore common ways that tools may do something correct, reasonable, and as-intended but very much not what we would have liked as analysts.



TODO: Introduce datasets

::: {.cell}

```{.r .cell-code}
head(registration)
```

::: {.cell-output-stdout}
```
  ID_CUSTOMER CD_DEVICE AMT_SPEND AMT_RETURN
1           1         1        10         NA
2           2         1        20         NA
3           3         1        30         NA
4           4         2        40         NA
5           5         2        50         NA
6           6         2        NA         NA
```
:::
:::

::: {.cell}

```{.python .cell-code}
1+1
```

::: {.cell-output-stdout}
```
2
```
:::
:::






## The meaning of a row

Often, data comes with an accompanying data dictionary to describe the meaning of each variable (column). However, for some reason, describing what constitutes an observation (row) is less common practice. This may seem obvious. In two of R's most popular built-in datasets, `iris` and `mtcars`, it's somewhat evident from context that each row represents one flower or one car. 

However, sometimes trying to glean this information from context alone can be misleading. Imagine, for example, that we want to calculate the rate of successful log-ins to our e-commerce website.

::: {.cell}
::: {.cell-output-stderr}
```
Warning: package 'tidyr' was built under R version 4.0.5
```
:::
:::

::: {.cell}

```{.r .cell-code}
summarize(logins, PROP_LOGIN = mean(IND_LOGIN))
```

::: {.cell-output-stdout}
```
# A tibble: 1 x 1
  PROP_LOGIN
       <dbl>
1        0.4
```
:::

```{.r .cell-code}
logins %>%
  group_by(ID_ACCT) %>% 
  summarize(IND_LOGIN = max(IND_LOGIN)) %>%
  ungroup() %>% 
  summarize(PROP_LOGIN = mean(IND_LOGIN))
```

::: {.cell-output-stdout}
```
# A tibble: 1 x 1
  PROP_LOGIN
       <dbl>
1        0.6
```
:::
:::

## The many forms of null

Frequently, real-world data sets suffer from at least some missing values. This missing data can cause complex computational and analytical challenges. Considering why one's data is missing and how such missing is encoded is critical before attempting an analysis.

It's tempting to think of missingness as a binary status: either a datum exists or it does not. However, missingness can arise from a number of different situations -- each with its own unique computational and analytical challenges. For example, in a tabular data representation, a variable (column) for an observation (row) might appear to be missing because:

- There exists a true value for that variable and entity but it is unknown
- There is no relevant value for that variable
- The relevant value for that variable *is* null

For example, consider the `registrations` dataset with data on users that have created an account at an online e-commerce platform:

- Users might be asked but not required to provide their date of birth; so, while every user *has* a birthday, only those that provide it would have a value for this field. Those that do not would be encoded as a `NULL`; (could also be only started collecting after certain dates, at a certain set of stores, data load error)
- We might also wish to record for mobile users if they were on an Android or and iPhone device when they registered. However, for users registering from a computer, there is no relevant value for this field. 
- Often, retailers want to attribute user traffic to different forms of advertising, so we might also have a field for the URL that directed users to our site. However, for users that truly typed in the URL directly and did not come through an affiliate link, the "true value" of the referring site is `NULL`. (Admittedly, there is significant overlap in the second two cases.)

Just as there are many potential causes for missingness in our data, there can often be many potential *encodings* of missingness.

The **naniar** package [@R-naniar] \index{R package!naniar}

Talk about encoding as like 9999

R has `NA`, `NaN`, `Inf`, `NULL`, and typed `NA`s

While this section focuses on the computational challenges of null values, no discussion of missingness would be complete without also mentioning the analytical consequences as well. Many statistical techniques such as linear regression are unable to accept null values in their inputs, so an analyst must somehow confront missingness before passing their data to the algorithm. Broadly speaking, analysts must either remove missing values or replace them with a proxy imputed value. There is a rich literature on missingness beyond the scope of this book, but briefly speaking this choice can be guided by the following framework. 

These different types of missingness must be handled differently because they insert different biases into our data. Someone (TODO: who and add citiation) classifies the level of missingness as:

- Missing Completely at Random (MCAR): TODO: finish defining these
- Missing at Random (MAR):
- Missing not a Random (MNAR):

Comparing these categories to the examples above, 

Literature about imputation; mention **mice** package (???)

One example of this is evident in the US Census Bureau's Medical Expenditure Panel Survey which uses the following reserved codes to denote different types of missingness. (TODO p10 https://www.meps.ahrq.gov/data_stats/download_data/pufs/h206a/h206adoc.pdf)

- -1 INAPPLICABLE Question was not asked due to skip pattern
- -7 REFUSED Question was asked and respondent refused to answer question
- -8 DK Question was asked and respondent did not know answer
- -14 NOT YET TAKEN/USED Respondent answered that the medicine has not yet been used
- -15 CANNOT BE COMPUTED Value cannot be derived from data

## Null value aggregation

As we've seen, null values in our data can mean many different things and be represented in many different ways. However, even once we have locked down the *semantic* meaning of nulls in our data and considered alternatives for their *encoding*, these values may still cause *computational* challenges.^[This problem is not isolated to data analysis tools. For an entertaining example, see the 2019 WIRED article "How a 'NULL' License Plate Landed One Hacker in Ticket Hell" [@barrett] which a real-world software system producing unintended and undesirable behavior when asked to deal with a word `'NULL'`.] How null values are handled in the simple aggregation of data varies both across different languages and across different functions within a language. To better understand the problems this might cause, we will look at examples in R and SQL.

First, consider the `registration` data set. To compute the average amount spent (`AMT_SPEND`) with the `dplyr` package, an analyst might first reasonably write the following `summarize()` statement. However, as we can see, due to the presence of null values within the `AMT_SPEND` column, the result of this aggregation is for the whole quantiaty of `AVG_SPEND` to be set to the value `NA`. 

::: {.cell}

```{.r .cell-code}
summarize(registration, AVG_SPEND = mean(AMT_SPEND))
```

::: {.cell-output-stdout}
```
  AVG_SPEND
1        NA
```
:::
:::

A glance at the documentation for the `mean()` function reveals that it has an `na.rm` parameter which, when set to true, removes null values from our dataset. Adding this argument to the previous statement allows us to reach a numerical answer.

::: {.cell}

```{.r .cell-code}
summarize(registration, 
          AVG_SPEND = mean(AMT_SPEND, na.rm = TRUE))
```

::: {.cell-output-stdout}
```
  AVG_SPEND
1  48.57143
```
:::
:::

However, is this the *right* numerical answer? What `na.rm = TRUE` does is *drop* the null values from the set of numbers being averaged. However, suppose the null values represent that no purchases were made. That is, zero dollars were spent. In effect, we have removed all non-purchasers from the data being averaged. 

More precisely, we have switched from taking the average

$$
  \frac{ \sum_{1}^{n} Spend }{\sum_{1}^{n} 1}
$$ over all $n$ customers

to taking the average

$$
  \frac{ \sum_{Spend > 0} Spend }{\sum_{Spend > 0} 1}
$$ over only those customers with spend

At face value, we could say that the code above is giving the incorrect answer; by dropping some low (zero) purchase amounts, the average amount spend per customer is inflated. A second and even more troubling perspective is that this tiny change to the code which seemed like a reasonable attempt to fix an *obvious* problem has introduced a *non-obvious* problem by fundamentally changing the question that we are asking. By dropping all accounts from our table who made no purchases, we are no longer answering "What is the average amount spent by a new registrant?" but rather "What is the average amount spent by an actively engaged customer?" This technical quirk has significant analytical impact.

To answer the real question at hand, we would instead have a couple of options. We could `sum()` the amount spent with the option to drop nulls but then divide by the correct denominator (all observations -- not just those with spend) or we could explicitly recode null values in `AMT_SPEND` to zero before taking the average. This leads to a lower but correct conclusion.

::: {.cell}

```{.r .cell-code}
summarize(registration,
    AVG_SPEND_v1 = sum(AMT_SPEND, na.rm = TRUE) / n(),
    AVG_SPEND_v2 = mean(ifelse(is.na(AMT_SPEND), 0, AMT_SPEND))
  )
```

::: {.cell-output-stdout}
```
  AVG_SPEND_v1 AVG_SPEND_v2
1           34           34
```
:::
:::

This is all well and good if we could just accept that the behaviors above are simply how nulls work, but further complexity comes as we see that there is no industry standard across tools. For example, as the SQL code below shows, SQL's `avg()` function behaves more like R's `mean()` *with* the `na.rm = TRUE` option set. That is, the default behavior of SQL is to only operate on the valid and available values. 

::: {.cell output.var='sql1'}

```{.sql .cell-code}
SELECT avg(amt_spend) 
FROM registration
```
:::

::: {.cell}
::: {.cell-output-stdout}
```
  avg(amt_spend)
1       48.57143
```
:::
:::

However, this is not to suggest that null values cannot also be destructive in SQL. While aggregation functions (which compute across a *row*) like `sum()` and `avg()` drop nulls, operators like `+` and `-` working *across columns* in the *same row* do not exhibit the same behavior. Consider, for example, if we wish to calculate the average net purchase amount (purchases minus returns) instead of the gross (total) purchase amount. 

::: {.cell output.var='sql2'}

```{.sql .cell-code}
SELECT avg(amt_spend-amt_return) 
FROM registration
```
:::

::: {.cell}
::: {.cell-output-stdout}
```
  avg(amt_spend-amt_return)
1                        NA
```
:::
:::

Despite what we learned above about the `avg()` function, the query above returns only a null value. What has happened? In our `registration` data set, the `amt_return` column is completely null (representing no returns). Because the subtraction occurs before the average is taken, subtracting real numbers in `amt_spend` with null values in `amt_return` creates a column of all null values which are then fed into the `avg()` function. This process is shown step-by-step below.

::: {.cell output.var='sql3'}

```{.sql .cell-code}
SELECT
  amt_spend, 
  amt_return, 
  amt_spend-amt_return 
FROM registration
```
:::

::: {.cell}
::: {.cell-output-stdout}
```
   AMT_SPEND AMT_RETURN amt_spend-amt_return
1         10         NA                   NA
2         20         NA                   NA
3         30         NA                   NA
4         40         NA                   NA
5         50         NA                   NA
6         NA         NA                   NA
7         NA         NA                   NA
8         NA         NA                   NA
9         90         NA                   NA
10       100         NA                   NA
```
:::
:::

## Null value filtering

`dplyr` excludes `NA`s in `filter`

::: {.cell}

```{.r .cell-code}
data.frame(x = c(1, 0, NA)) %>%
  filter(x != 1)
```

::: {.cell-output-stdout}
```
  x
1 0
```
:::
:::

`SQL` excludes `NA`s in `WHERE`

::: {.cell output.var='sql4'}

```{.sql .cell-code}
select *
from registration
where amt_spend != 10
```
:::

::: {.cell}
::: {.cell-output-stdout}
```
  ID_CUSTOMER CD_DEVICE AMT_SPEND AMT_RETURN
1           2         1        20         NA
2           3         1        30         NA
3           4         2        40         NA
4           5         2        50         NA
5           9         3        90         NA
6          10         3       100         NA
```
:::
:::

```
import pandas as pd
d = {'col1': [1, None], 'col2': [3, 4]}
df = pd.DataFrame(data=d)
df
df.query('col1 > 0')
df[df['col1'] > 0]
```

## Encoding with defaults

Often, to faciliate an analysis, we wish to **recode** variables from one form to another. There are many reasons we might wish to recode variables. Sometimes, our data may be represented with system-generated codes that obscure the context-specific meaning of fields. For example, if you are analyzing US Census data, it might identify different regions by their FIPS code while a human might prefer to see the actual name of a state or a county. In other cases, we wish to recode fields in order to change their level of granularity. For example, we might wish to group categories such as "apple", "banana", and "orange" into the "fruit" category.

Common functions for recoding include `base::ifelse`\index{base!ifelse}\index{R!ifelse}, `dplyr::if_else`\index{dplyr!if\_else}\index{R!if\_else}, and `dplyr::case_when`\index{dplyr!case\_when}\index{R!case\_when} in R and `CASE` statements in SQL\index{SQL!case}. Generally, all of these work by:

- specifying one or more logical conditions based on other column(s) in the dataset
- for each logical condition, specifying the new value that the variable should take
- if none of the conditions are met, providing a default value

However, analysts may often take on slight short-cut

::: {.cell}

```{.r .cell-code}
registration <-
mutate(registration,
       CAT_DEVICE = case_when(
         CD_DEVICE == 1 ~ "IOS",
         TRUE ~ "Android"
       )
       )

registration %>%
  group_by(CAT_DEVICE) %>%
  count()
```

::: {.cell-output-stdout}
```
# A tibble: 2 x 2
# Groups:   CAT_DEVICE [2]
  CAT_DEVICE     n
  <chr>      <int>
1 Android        7
2 IOS            3
```
:::
:::

::: {.cell}

```{.r .cell-code}
unique(registration$CD_DEVICE)
```

::: {.cell-output-stdout}
```
[1] 1 2 3
```
:::
:::

::: {.cell}

```{.r .cell-code}
registration <- 
  mutate(registration, 
         IND_SMALL_PURCH = case_when(
           AMT_SPEND < 50 ~ 1,  
           TRUE ~ 0)
         )
                       
registration %>%
  group_by(IND_SMALL_PURCH) %>%
  count()
```

::: {.cell-output-stdout}
```
# A tibble: 2 x 2
# Groups:   IND_SMALL_PURCH [2]
  IND_SMALL_PURCH     n
            <dbl> <int>
1               0     6
2               1     4
```
:::

```{.r .cell-code}
registration <-
  mutate(registration, 
         IND_SMALL_PURCH = if_else(AMT_SPEND < 50, 1, 0))
                       
registration %>%
  group_by(IND_SMALL_PURCH) %>%
  count()
```

::: {.cell-output-stdout}
```
# A tibble: 3 x 2
# Groups:   IND_SMALL_PURCH [3]
  IND_SMALL_PURCH     n
            <dbl> <int>
1               0     3
2               1     4
3              NA     3
```
:::
:::

## Working with strings

## Data Types - Max

::: {.cell}

```{.r .cell-code}
any(
  "a" == "A",
  " a" == "a",
  "a " == "a",
  "a  b" == "a b",
  "‘z’" == "'z'"
)
```

::: {.cell-output-stdout}
```
[1] FALSE
```
:::
:::

::: {.cell}

```{.r .cell-code}
max(c("20200101", "20190301"))
```

::: {.cell-output-stdout}
```
[1] "20200101"
```
:::

```{.r .cell-code}
max(c("03012019", "01012020"))
```

::: {.cell-output-stdout}
```
[1] "03012019"
```
:::

```{.r .cell-code}
max(c("120","99"))
```

::: {.cell-output-stdout}
```
[1] "99"
```
:::

```{.r .cell-code}
max(c("120","099"))
```

::: {.cell-output-stdout}
```
[1] "120"
```
:::

```{.r .cell-code}
max(c(120,99))
```

::: {.cell-output-stdout}
```
[1] 120
```
:::

```{.r .cell-code}
max(c(120,099))
```

::: {.cell-output-stdout}
```
[1] 120
```
:::
:::

::: {.cell}

```{.sql .cell-code}
select 
  max('20200101', '20190301'),
  max('01012020', '03012019'),
  max('120','99'),
  max('120','099'),
  max(120,99),
  max(120,099)
```


<div class="knitsql-table">


Table: 1 records

|max('20200101', '20190301') |max('01012020', '03012019') |max('120','99') |max('120','099') | max(120,99)| max(120,099)|
|:---------------------------|:---------------------------|:---------------|:----------------|-----------:|------------:|
|20200101                    |03012019                    |99              |120              |         120|          120|

</div>
:::

::: {.cell}

```{.python .cell-code}
max(["20200101", "20190301"])
```

::: {.cell-output-stdout}
```
'20200101'
```
:::

```{.python .cell-code}
max(["03012019", "01012020"])
```

::: {.cell-output-stdout}
```
'03012019'
```
:::

```{.python .cell-code}
max(["120","99"])
```

::: {.cell-output-stdout}
```
'99'
```
:::

```{.python .cell-code}
max(["120","099"])
```

::: {.cell-output-stdout}
```
'120'
```
:::

```{.python .cell-code}
max([120,99])
#max([120,099]) Python won't allow leading zeros on integers
```

::: {.cell-output-stdout}
```
120
```
:::
:::

## Data Types - Equality

::: {.cell}

```{.r .cell-code}
"2020" == 2020
```

::: {.cell-output-stdout}
```
[1] TRUE
```
:::

```{.r .cell-code}
"02020" == 2020
```

::: {.cell-output-stdout}
```
[1] FALSE
```
:::
:::

::: {.cell}

```{.sql .cell-code}
select 
  '2020' == 2020,
  '02020' == 2020,
  cast('2020' as numeric) == 2020,
  cast('2020' as integer) == 2020
```


<div class="knitsql-table">


Table: 1 records

| '2020' == 2020| '02020' == 2020| cast('2020' as numeric) == 2020| cast('2020' as integer) == 2020|
|--------------:|---------------:|-------------------------------:|-------------------------------:|
|              0|               0|                               1|                               1|

</div>
:::

::: {.cell}

```{.python .cell-code}
"2020" == 2020
```

::: {.cell-output-stdout}
```
False
```
:::

```{.python .cell-code}
"02020" == 2020
```

::: {.cell-output-stdout}
```
False
```
:::
:::

`python 1+1`

## Working with dates and times

### Many different formats

- YYYYMMDD
- MMDDYYYY
- MM/DD/YYYY
- MM/DD/YY
- DDMMYYYY
- DD/MM/YYYY

### Timestamps versus dates

::: {.cell}

```{.r .cell-code}
today <- as.Date(Sys.Date()) 
now <- as.POSIXct(Sys.time(), "America/New_York")
today == now
```

::: {.cell-output-stderr}
```
Warning: Incompatible methods ("Ops.Date", "Ops.POSIXt") for "=="
```
:::

::: {.cell-output-stdout}
```
[1] FALSE
```
:::

```{.r .cell-code}
today > now
```

::: {.cell-output-stderr}
```
Warning: Incompatible methods ("Ops.Date", "Ops.POSIXt") for ">"
```
:::

::: {.cell-output-stdout}
```
[1] FALSE
```
:::

```{.r .cell-code}
today < now
```

::: {.cell-output-stderr}
```
Warning: Incompatible methods ("Ops.Date", "Ops.POSIXt") for "<"
```
:::

::: {.cell-output-stdout}
```
[1] TRUE
```
:::
:::

::: {.cell}

```{.python .cell-code}
from datetime import date
from datetime import datetime

today = date.today()
now = datetime.now()
today == now
```

::: {.cell-output-stdout}
```
False
```
:::

```{.python .cell-code}
today < now
```

::: {.cell-output-error}
```
Error in py_call_impl(callable, dots$args, dots$keywords): TypeError: can't compare datetime.datetime to datetime.date

Detailed traceback:
  File "<string>", line 1, in <module>
```
:::

```{.python .cell-code}
today > now
```

::: {.cell-output-error}
```
Error in py_call_impl(callable, dots$args, dots$keywords): TypeError: can't compare datetime.datetime to datetime.date

Detailed traceback:
  File "<string>", line 1, in <module>
```
:::

```{.python .cell-code}
today_str = today.strftime('%Y-%m-%d')
now_str = now.strftime('%Y-%m-%d %H:%M:%S')
today_str == now_str
```

::: {.cell-output-stdout}
```
False
```
:::

```{.python .cell-code}
today_str < now_str
```

::: {.cell-output-stdout}
```
True
```
:::

```{.python .cell-code}
today_str > now_str
```

::: {.cell-output-stdout}
```
False
```
:::
:::

## Assessing equality

Automatic conversion of data types
Dates versus timestamps 

::: {.cell}

```{.r .cell-code}
df_dt <-
data.frame(
  DT_ENROLL = as.Date("2020-01-01"),
  DT_PURCH  = 20200101,
  DT_LOGIN  = as.POSIXlt("2020-01-01T12:00:00") 
  )
```
:::

::: {.cell}

```{.r .cell-code}
filter(df_dt, DT_ENROLL == DT_PURCH) %>% nrow()
```

::: {.cell-output-stdout}
```
[1] 0
```
:::
:::

::: {.cell}

```{.r .cell-code}
sqldf("select * from df_dt where DT_ENROLL = DT_PURCH")
```

::: {.cell-output-stdout}
```
[1] DT_ENROLL DT_PURCH  DT_LOGIN 
<0 rows> (or 0-length row.names)
```
:::
:::

::: {.cell}

```{.r .cell-code}
as.numeric(df_dt$DT_ENROLL)
```

::: {.cell-output-stdout}
```
[1] 18262
```
:::
:::

::: {.cell}

```{.r .cell-code}
sqldf("select cast(DT_ENROLL as integer) from df_dt")
```

::: {.cell-output-stdout}
```
  cast(DT_ENROLL as integer)
1                      18262
```
:::
:::

Note this this can affect both filters and joins

## Merging mayhem


## Modifying versus copying




## Inefficient processing

::: {.cell}

```{.r .cell-code}
n <- 1000000
x1 = 1:n
x2 = 1:n

start_time <- Sys.time()
for (i in 1:n) {
  x1[i] = x1[i] + 1
}
end_time <- Sys.time()
t_for <- end_time - start_time

start_time <- Sys.time()
x2 = x2 + 1
end_time <- Sys.time()
t_vec <- end_time - start_time

t_for
```

::: {.cell-output-stdout}
```
Time difference of 0.1450021 secs
```
:::

```{.r .cell-code}
t_vec
```

::: {.cell-output-stdout}
```
Time difference of 0.06200004 secs
```
:::

```{.r .cell-code}
as.numeric(t_for)/as.numeric(t_vec)
```

::: {.cell-output-stdout}
```
[1] 2.338743
```
:::
:::

::: {.cell}

```{.python .cell-code}
import numpy as np
import time

n = 1000000
x1 = list(range(n))
x2 = np.array(x1)

t0 = time.time()
for i in range(n):
  x1[i] += 1
t1 = time.time()
t_for = t1-t0

t0 = time.time()
x2 += 1
t1 = time.time()
t_vec = t1-t0

t_for
```

::: {.cell-output-stdout}
```
0.3599989414215088
```
:::

```{.python .cell-code}
t_vec
```

::: {.cell-output-stdout}
```
0.026314496994018555
```
:::

```{.python .cell-code}
t_for / t_vec
```

::: {.cell-output-stdout}
```
13.68063168767158
```
:::
:::

-->



<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-barrett" class="csl-entry" role="doc-biblioentry">
Barrett, Brian. 2019. <span>“How a ’NULL’ License Plate Landed One Hacker in Ticket Hell.”</span> <em>WIRED</em>, August. <a href="https://www.wired.com/story/null-license-plate-landed-one-hacker-ticket-hell/">https://www.wired.com/story/null-license-plate-landed-one-hacker-ticket-hell/</a>.
</div>
</div>
</section><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1" role="doc-endnote"><p>This problem is not isolated to data analysis tools. For an entertaining example, see the 2019 WIRED article “How a ‘NULL’ License Plate Landed One Hacker in Ticket Hell” <span class="citation" data-cites="barrett">(<a href="references.html#ref-barrett" role="doc-biblioref">Barrett 2019</a>)</span> which a real-world software system producing unintended and undesirable behavior when asked to deal with a word <code>'NULL'</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>You’ll notice that the code chunk below contains four commands but only three boolean outputs. Why is that? <code>is.na(NULL)</code> returns <code>logical(0)</code>, a zero-length value. It’s yet another form of missingness!<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>From calculus, we know 1/Inf approaches 0, but Inf/Inf is undefined.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>This documentation can be obtained in R by typing <code><a href="https://rdrr.io/r/base/mean.html">?mean</a></code> in the console.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>Recoding can be done with a number of different general purpose functions like <code>ifelse</code> or <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">dplyr::case_when</a></code> in R. Different SQL varaints often offer different options for this purpose with functions such as <code>nvl()</code> or <code>zeroifnull()</code>. A common version across many language is <code><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce()</a></code> which takes the first non-null argument listed.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>If a = b and b = c then a = c<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7" role="doc-endnote"><p>I can accurately say my name is “Emily”, “Emily Riederer”, “Emily E. Riederer”, “Ms.&nbsp;Emily Riederer”. Additionally, if I spell my name over the phone, I can likely end up “Emily Rieder” or if I type it and mindlessly accept autocorrect, I’m “Emily Reindeer”. This inconsistently may be problematic if you are trying to combine my data across different sources where I provided my name in different ways.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8" role="doc-endnote"><p>Similarly, <code>"91" &gt; "905"</code> because since they both start with 9, we move on to compare 1 which is greater than 0.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9" role="doc-endnote"><p>Different versions of SQL may differ<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10" role="doc-endnote"><p>A classic modeling technique for predicting binary (yes/no) outcomes<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./data-dall.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Dalliances (WIP)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./egre-aggr.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Egregious Aggregations (WIP)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->


</body></html>